{{## def.setupKeyword:
  {{
    var $lvl = it.level;
    var $dataLvl = it.dataLevel;
    var $schema = it.schema[$keyword];
    var $schemaPath = it.schemaPath + it.util.getProperty($keyword);
    var $errSchemaPath = it.errSchemaPath + '/' + $keyword;
    var $breakOnError = !it.opts.allErrors;
    var $errorKeyword;

    var $data = 'data' + ($dataLvl || '');
    var $valid = 'valid' + $lvl;
    var $errs = 'errs__' + $lvl;
  ***REMOVED******REMOVED***
#***REMOVED******REMOVED***


{{## def.setCompositeRule:
  {{
    var $wasComposite = it.compositeRule;
    it.compositeRule = $it.compositeRule = true;
  ***REMOVED******REMOVED***
#***REMOVED******REMOVED***


{{## def.resetCompositeRule:
  {{ it.compositeRule = $it.compositeRule = $wasComposite; ***REMOVED******REMOVED***
#***REMOVED******REMOVED***


{{## def.setupNextLevel:
  {{
    var $it = it.util.copy(it);
    var $closingBraces = '';
    $it.level++;
    var $nextValid = 'valid' + $it.level;
  ***REMOVED******REMOVED***
#***REMOVED******REMOVED***


{{## def.ifValid:
  {{? $breakOnError ***REMOVED******REMOVED***
    if ({{=$valid***REMOVED******REMOVED***) {
    {{ $closingBraces += '***REMOVED***'; ***REMOVED******REMOVED***
  {{?***REMOVED******REMOVED***
#***REMOVED******REMOVED***


{{## def.ifResultValid:
  {{? $breakOnError ***REMOVED******REMOVED***
    if ({{=$nextValid***REMOVED******REMOVED***) {
    {{ $closingBraces += '***REMOVED***'; ***REMOVED******REMOVED***
  {{?***REMOVED******REMOVED***
#***REMOVED******REMOVED***


{{## def.elseIfValid:
  {{? $breakOnError ***REMOVED******REMOVED***
    {{ $closingBraces += '***REMOVED***'; ***REMOVED******REMOVED***
    else {
  {{?***REMOVED******REMOVED***
#***REMOVED******REMOVED***


{{## def.nonEmptySchema:_schema:
  (it.opts.strictKeywords
    ? (typeof _schema == 'object' && Object.keys(_schema).length > 0)
      || _schema === false
    : it.util.schemaHasRules(_schema, it.RULES.all))
#***REMOVED******REMOVED***


{{## def.strLength:
  {{? it.opts.unicode === false ***REMOVED******REMOVED***
    {{=$data***REMOVED******REMOVED***.length
  {{??***REMOVED******REMOVED***
    ucs2length({{=$data***REMOVED******REMOVED***)
  {{?***REMOVED******REMOVED***
#***REMOVED******REMOVED***


{{## def.willOptimize:
  it.util.varOccurences($code, $nextData) < 2
#***REMOVED******REMOVED***


{{## def.generateSubschemaCode:
  {{
    var $code = it.validate($it);
    $it.baseId = $currentBaseId;
  ***REMOVED******REMOVED***
#***REMOVED******REMOVED***


{{## def.insertSubschemaCode:
  {{= it.validate($it) ***REMOVED******REMOVED***
  {{ $it.baseId = $currentBaseId; ***REMOVED******REMOVED***
#***REMOVED******REMOVED***


{{## def._optimizeValidate:
  it.util.varReplace($code, $nextData, $passData)
#***REMOVED******REMOVED***


{{## def.optimizeValidate:
  {{? {{# def.willOptimize***REMOVED******REMOVED*** ***REMOVED******REMOVED***
    {{= {{# def._optimizeValidate ***REMOVED******REMOVED*** ***REMOVED******REMOVED***
  {{??***REMOVED******REMOVED***
    var {{=$nextData***REMOVED******REMOVED*** = {{=$passData***REMOVED******REMOVED***;
    {{= $code ***REMOVED******REMOVED***
  {{?***REMOVED******REMOVED***
#***REMOVED******REMOVED***


{{## def.$data:
  {{
    var $isData = it.opts.$data && $schema && $schema.$data
      , $schemaValue;
  ***REMOVED******REMOVED***
  {{? $isData ***REMOVED******REMOVED***
    var schema{{=$lvl***REMOVED******REMOVED*** = {{= it.util.getData($schema.$data, $dataLvl, it.dataPathArr) ***REMOVED******REMOVED***;
    {{ $schemaValue = 'schema' + $lvl; ***REMOVED******REMOVED***
  {{??***REMOVED******REMOVED***
    {{ $schemaValue = $schema; ***REMOVED******REMOVED***
  {{?***REMOVED******REMOVED***
#***REMOVED******REMOVED***


{{## def.$dataNotType:_type:
  {{?$isData***REMOVED******REMOVED*** ({{=$schemaValue***REMOVED******REMOVED*** !== undefined && typeof {{=$schemaValue***REMOVED******REMOVED*** != _type) || {{?***REMOVED******REMOVED***
#***REMOVED******REMOVED***


{{## def.check$dataIsArray:
  if (schema{{=$lvl***REMOVED******REMOVED*** === undefined) {{=$valid***REMOVED******REMOVED*** = true;
  else if (!Array.isArray(schema{{=$lvl***REMOVED******REMOVED***)) {{=$valid***REMOVED******REMOVED*** = false;
  else {
#***REMOVED******REMOVED***


{{## def.numberKeyword:
  {{? !($isData || typeof $schema == 'number') ***REMOVED******REMOVED***
    {{ throw new Error($keyword + ' must be number'); ***REMOVED******REMOVED***
  {{?***REMOVED******REMOVED***
#***REMOVED******REMOVED***


{{## def.beginDefOut:
  {{
    var $$outStack = $$outStack || [];
    $$outStack.push(out);
    out = '';
  ***REMOVED******REMOVED***
#***REMOVED******REMOVED***


{{## def.storeDefOut:_variable:
  {{
    var _variable = out;
    out = $$outStack.pop();
  ***REMOVED******REMOVED***
#***REMOVED******REMOVED***


{{## def.dataPath:(dataPath || ''){{? it.errorPath != '""'***REMOVED******REMOVED*** + {{= it.errorPath ***REMOVED******REMOVED***{{?***REMOVED******REMOVED***#***REMOVED******REMOVED***

{{## def.setParentData:
  {{
    var $parentData = $dataLvl ? 'data' + (($dataLvl-1)||'') : 'parentData'
      , $parentDataProperty = $dataLvl ? it.dataPathArr[$dataLvl] : 'parentDataProperty';
  ***REMOVED******REMOVED***
#***REMOVED******REMOVED***

{{## def.passParentData:
  {{# def.setParentData ***REMOVED******REMOVED***
  , {{= $parentData ***REMOVED******REMOVED***
  , {{= $parentDataProperty ***REMOVED******REMOVED***
#***REMOVED******REMOVED***


{{## def.iterateProperties:
  {{? $ownProperties ***REMOVED******REMOVED***
    {{=$dataProperties***REMOVED******REMOVED*** = {{=$dataProperties***REMOVED******REMOVED*** || Object.keys({{=$data***REMOVED******REMOVED***);
    for (var {{=$idx***REMOVED******REMOVED***=0; {{=$idx***REMOVED******REMOVED***<{{=$dataProperties***REMOVED******REMOVED***.length; {{=$idx***REMOVED******REMOVED***++) {
      var {{=$key***REMOVED******REMOVED*** = {{=$dataProperties***REMOVED******REMOVED***[{{=$idx***REMOVED******REMOVED***];
  {{??***REMOVED******REMOVED***
    for (var {{=$key***REMOVED******REMOVED*** in {{=$data***REMOVED******REMOVED***) {
  {{?***REMOVED******REMOVED***
#***REMOVED******REMOVED***


{{## def.noPropertyInData:
  {{=$useData***REMOVED******REMOVED*** === undefined
  {{? $ownProperties ***REMOVED******REMOVED***
    || !{{# def.isOwnProperty ***REMOVED******REMOVED***
  {{?***REMOVED******REMOVED***
#***REMOVED******REMOVED***


{{## def.isOwnProperty:
  Object.prototype.hasOwnProperty.call({{=$data***REMOVED******REMOVED***, '{{=it.util.escapeQuotes($propertyKey)***REMOVED******REMOVED***')
#***REMOVED******REMOVED***

/**
 * @fileoverview Disallow tabindex on static and noninteractive elements
 * @author jessebeach
 */

// -----------------------------------------------------------------------------
// Requirements
// -----------------------------------------------------------------------------

import { RuleTester ***REMOVED*** from 'eslint';
import { configs ***REMOVED*** from '../../../src/index';
import parserOptionsMapper from '../../__util__/parserOptionsMapper';
import parsers from '../../__util__/helpers/parsers';
import rule from '../../../src/rules/no-noninteractive-tabindex';
import ruleOptionsMapperFactory from '../../__util__/ruleOptionsMapperFactory';

// -----------------------------------------------------------------------------
// Tests
// -----------------------------------------------------------------------------

const ruleTester = new RuleTester();

const ruleName = 'no-noninteractive-tabindex';

const expectedError = {
  message: '`tabIndex` should only be declared on interactive elements.',
  type: 'JSXAttribute',
***REMOVED***;

const componentsSettings = {
  'jsx-a11y': {
    components: {
      Article: 'article',
      MyButton: 'button',
    ***REMOVED***,
  ***REMOVED***,
***REMOVED***;

const alwaysValid = [
  { code: '<MyButton tabIndex={0***REMOVED*** />' ***REMOVED***,
  { code: '<button />' ***REMOVED***,
  { code: '<button tabIndex="0" />' ***REMOVED***,
  { code: '<button tabIndex={0***REMOVED*** />' ***REMOVED***,
  { code: '<div />' ***REMOVED***,
  { code: '<div tabIndex="-1" />' ***REMOVED***,
  { code: '<div role="button" tabIndex="0" />' ***REMOVED***,
  { code: '<div role="article" tabIndex="-1" />' ***REMOVED***,
  { code: '<article tabIndex="-1" />' ***REMOVED***,
  { code: '<Article tabIndex="-1" />', settings: componentsSettings ***REMOVED***,
  { code: '<MyButton tabIndex={0***REMOVED*** />', settings: componentsSettings ***REMOVED***,
];

const neverValid = [
  { code: '<div tabIndex="0" />', errors: [expectedError] ***REMOVED***,
  { code: '<div role="article" tabIndex="0" />', errors: [expectedError] ***REMOVED***,
  { code: '<article tabIndex="0" />', errors: [expectedError] ***REMOVED***,
  { code: '<article tabIndex={0***REMOVED*** />', errors: [expectedError] ***REMOVED***,
  { code: '<Article tabIndex={0***REMOVED*** />', errors: [expectedError], settings: componentsSettings ***REMOVED***,
];

const recommendedOptions = (
  configs.recommended.rules[`jsx-a11y/${ruleName***REMOVED***`][1] || {***REMOVED***
);

ruleTester.run(`${ruleName***REMOVED***:recommended`, rule, {
  valid: parsers.all([].concat(
    ...alwaysValid,
    { code: '<div role="tabpanel" tabIndex="0" />' ***REMOVED***,
    // Expressions should pass in recommended mode
    { code: '<div role={ROLE_BUTTON***REMOVED*** onClick={() => {***REMOVED******REMOVED*** tabIndex="0" />;' ***REMOVED***,
    // Cases for allowExpressionValues set to true
    {
      code: '<div role={BUTTON***REMOVED*** onClick={() => {***REMOVED******REMOVED*** tabIndex="0" />;',
      options: [{ allowExpressionValues: true ***REMOVED***],
    ***REMOVED***,
    // Specific case for ternary operator with literals on both side
    {
      code: '<div role={isButton ? "button" : "link"***REMOVED*** onClick={() => {***REMOVED******REMOVED*** tabIndex="0" />;',
      options: [{ allowExpressionValues: true ***REMOVED***],
    ***REMOVED***,
    {
      code: '<div role={isButton ? "button" : LINK***REMOVED*** onClick={() => {***REMOVED******REMOVED*** tabIndex="0" />;',
      options: [{ allowExpressionValues: true ***REMOVED***],
      errors: [expectedError],
    ***REMOVED***,
    {
      code: '<div role={isButton ? BUTTON : LINK***REMOVED*** onClick={() => {***REMOVED******REMOVED*** tabIndex="0"/>;',
      options: [{ allowExpressionValues: true ***REMOVED***],
      errors: [expectedError],
    ***REMOVED***,
  ))
    .map(ruleOptionsMapperFactory(recommendedOptions))
    .map(parserOptionsMapper),
  invalid: parsers.all([].concat(
    ...neverValid,
  ))
    .map(ruleOptionsMapperFactory(recommendedOptions))
    .map(parserOptionsMapper),
***REMOVED***);

ruleTester.run(`${ruleName***REMOVED***:strict`, rule, {
  valid: parsers.all([].concat(
    ...alwaysValid,
  )).map(parserOptionsMapper),
  invalid: parsers.all([].concat(
    ...neverValid,
    { code: '<div role="tabpanel" tabIndex="0" />', errors: [expectedError] ***REMOVED***,
    // Expressions should fail in strict mode
    { code: '<div role={ROLE_BUTTON***REMOVED*** onClick={() => {***REMOVED******REMOVED*** tabIndex="0" />;', errors: [expectedError] ***REMOVED***,
    // Cases for allowExpressionValues set to false
    {
      code: '<div role={BUTTON***REMOVED*** onClick={() => {***REMOVED******REMOVED*** tabIndex="0" />;',
      options: [{ allowExpressionValues: false ***REMOVED***],
      errors: [expectedError],
    ***REMOVED***,
    // Specific case for ternary operator with literals on both side
    {
      code: '<div role={isButton ? "button" : "link"***REMOVED*** onClick={() => {***REMOVED******REMOVED*** tabIndex="0" />;',
      options: [{ allowExpressionValues: false ***REMOVED***],
      errors: [expectedError],
    ***REMOVED***,
  )).map(parserOptionsMapper),
***REMOVED***);

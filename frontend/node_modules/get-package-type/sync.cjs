'use strict';

const path = require('path');
const {readFileSync***REMOVED*** = require('fs');

const isNodeModules = require('./is-node-modules.cjs');
const resultsCache = require('./cache.cjs');

function getDirectoryTypeActual(directory) {
	if (isNodeModules(directory)) {
		return 'commonjs';
	***REMOVED***

	try {
		return JSON.parse(readFileSync(path.resolve(directory, 'package.json'))).type || 'commonjs';
	***REMOVED*** catch (_) {
	***REMOVED***

	const parent = path.dirname(directory);
	if (parent === directory) {
		return 'commonjs';
	***REMOVED***

	return getDirectoryType(parent);
***REMOVED***

function getDirectoryType(directory) {
	if (resultsCache.has(directory)) {
		return resultsCache.get(directory);
	***REMOVED***

	const result = getDirectoryTypeActual(directory);
	resultsCache.set(directory, result);

	return result;
***REMOVED***

function getPackageTypeSync(filename) {
	return getDirectoryType(path.resolve(path.dirname(filename)));
***REMOVED***

module.exports = getPackageTypeSync;

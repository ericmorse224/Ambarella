var List = require('css-tree').List;

module.exports = function compressBackground(node) {
    function lastType() {
        if (buffer.length) {
            return buffer[buffer.length - 1].type;
        ***REMOVED***
    ***REMOVED***

    function flush() {
        if (lastType() === 'WhiteSpace') {
            buffer.pop();
        ***REMOVED***

        if (!buffer.length) {
            buffer.unshift(
                {
                    type: 'Number',
                    loc: null,
                    value: '0'
                ***REMOVED***,
                {
                    type: 'WhiteSpace',
                    value: ' '
                ***REMOVED***,
                {
                    type: 'Number',
                    loc: null,
                    value: '0'
                ***REMOVED***
            );
        ***REMOVED***

        newValue.push.apply(newValue, buffer);

        buffer = [];
    ***REMOVED***

    var newValue = [];
    var buffer = [];

    node.children.each(function(node) {
        if (node.type === 'Operator' && node.value === ',') {
            flush();
            newValue.push(node);
            return;
        ***REMOVED***

        // remove defaults
        if (node.type === 'Identifier') {
            if (node.name === 'transparent' ||
                node.name === 'none' ||
                node.name === 'repeat' ||
                node.name === 'scroll') {
                return;
            ***REMOVED***
        ***REMOVED***

        // don't add redundant spaces
        if (node.type === 'WhiteSpace' && (!buffer.length || lastType() === 'WhiteSpace')) {
            return;
        ***REMOVED***

        buffer.push(node);
    ***REMOVED***);

    flush();
    node.children = new List().fromArray(newValue);
***REMOVED***;

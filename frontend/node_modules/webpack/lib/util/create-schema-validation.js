/*
	MIT License http://www.opensource.org/licenses/mit-license.php
	Author Tobias Koppers @sokra
*/

"use strict";

const memoize = require("./memoize");

/** @typedef {import("schema-utils/declarations/validate").ValidationErrorConfiguration***REMOVED*** ValidationErrorConfiguration */
/** @typedef {import("./fs").JsonObject***REMOVED*** JsonObject */

const getValidate = memoize(() => require("schema-utils").validate);

/**
 * @template {object | object[]***REMOVED*** T
 * @param {((value: T) => boolean) | undefined***REMOVED*** check check
 * @param {() => JsonObject***REMOVED*** getSchema get schema fn
 * @param {ValidationErrorConfiguration***REMOVED*** options options
 * @returns {(value?: T) => void***REMOVED*** validate
 */
const createSchemaValidation = (check, getSchema, options) => {
	getSchema = memoize(getSchema);
	return value => {
		if (check && value && !check(value)) {
			getValidate()(
				getSchema(),
				/** @type {EXPECTED_OBJECT | EXPECTED_OBJECT[]***REMOVED*** */
				(value),
				options
			);
			require("util").deprecate(
				() => {***REMOVED***,
				"webpack bug: Pre-compiled schema reports error while real schema is happy. This has performance drawbacks.",
				"DEP_WEBPACK_PRE_COMPILED_SCHEMA_INVALID"
			)();
		***REMOVED***
	***REMOVED***;
***REMOVED***;

module.exports = createSchemaValidation;

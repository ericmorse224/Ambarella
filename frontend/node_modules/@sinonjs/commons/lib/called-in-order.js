"use strict";

var every = require("./prototypes/array").every;

/**
 * @private
 */
function hasCallsLeft(callMap, spy) {
    if (callMap[spy.id] === undefined) {
        callMap[spy.id] = 0;
    ***REMOVED***

    return callMap[spy.id] < spy.callCount;
***REMOVED***

/**
 * @private
 */
function checkAdjacentCalls(callMap, spy, index, spies) {
    var calledBeforeNext = true;

    if (index !== spies.length - 1) {
        calledBeforeNext = spy.calledBefore(spies[index + 1]);
    ***REMOVED***

    if (hasCallsLeft(callMap, spy) && calledBeforeNext) {
        callMap[spy.id] += 1;
        return true;
    ***REMOVED***

    return false;
***REMOVED***

/**
 * A Sinon proxy object (fake, spy, stub)
 *
 * @typedef {object***REMOVED*** SinonProxy
 * @property {Function***REMOVED*** calledBefore - A method that determines if this proxy was called before another one
 * @property {string***REMOVED*** id - Some id
 * @property {number***REMOVED*** callCount - Number of times this proxy has been called
 */

/**
 * Returns true when the spies have been called in the order they were supplied in
 *
 * @param  {SinonProxy[] | SinonProxy***REMOVED*** spies An array of proxies, or several proxies as arguments
 * @returns {boolean***REMOVED*** true when spies are called in order, false otherwise
 */
function calledInOrder(spies) {
    var callMap = {***REMOVED***;
    // eslint-disable-next-line no-underscore-dangle
    var _spies = arguments.length > 1 ? arguments : spies;

    return every(_spies, checkAdjacentCalls.bind(null, callMap));
***REMOVED***

module.exports = calledInOrder;

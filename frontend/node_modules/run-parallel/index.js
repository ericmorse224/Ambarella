/*! run-parallel. MIT License. Feross Aboukhadijeh <https://feross.org/opensource> */
module.exports = runParallel

const queueMicrotask = require('queue-microtask')

function runParallel (tasks, cb) {
  let results, pending, keys
  let isSync = true

  if (Array.isArray(tasks)) {
    results = []
    pending = tasks.length
  ***REMOVED*** else {
    keys = Object.keys(tasks)
    results = {***REMOVED***
    pending = keys.length
  ***REMOVED***

  function done (err) {
    function end () {
      if (cb) cb(err, results)
      cb = null
    ***REMOVED***
    if (isSync) queueMicrotask(end)
    else end()
  ***REMOVED***

  function each (i, err, result) {
    results[i] = result
    if (--pending === 0 || err) {
      done(err)
    ***REMOVED***
  ***REMOVED***

  if (!pending) {
    // empty
    done(null)
  ***REMOVED*** else if (keys) {
    // object
    keys.forEach(function (key) {
      tasks[key](function (err, result) { each(key, err, result) ***REMOVED***)
    ***REMOVED***)
  ***REMOVED*** else {
    // array
    tasks.forEach(function (task, i) {
      task(function (err, result) { each(i, err, result) ***REMOVED***)
    ***REMOVED***)
  ***REMOVED***

  isSync = false
***REMOVED***

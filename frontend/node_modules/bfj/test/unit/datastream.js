'use strict'

const assert = require('chai').assert
const spooks = require('spooks')

const modulePath = '../../src/datastream'

suite('datastream:', () => {
  let log

  setup(() => {
    log = {***REMOVED***
  ***REMOVED***)

  test('require does not throw', () => {
    assert.doesNotThrow(() => {
      require(modulePath)
    ***REMOVED***)
  ***REMOVED***)

  test('require returns function', () => {
    assert.isFunction(require(modulePath))
  ***REMOVED***)

  suite('require:', () => {
    let Stream

    setup(() => {
      Stream = require(modulePath)
    ***REMOVED***)

    test('Stream expects two arguments', () => {
      assert.lengthOf(Stream, 2)
    ***REMOVED***)

    test('calling Stream with function argument doesNotThrow', () => {
      assert.doesNotThrow(() => {
        Stream(() => {***REMOVED***)
      ***REMOVED***)
    ***REMOVED***)

    test('calling Stream with object argument throws', () => {
      assert.throws(() => {
        Stream({ read: () => {***REMOVED*** ***REMOVED***)
      ***REMOVED***)
    ***REMOVED***)

    test('calling Stream with new returns Stream instance', () => {
      assert.instanceOf(new Stream(() => {***REMOVED***), Stream)
    ***REMOVED***)

    test('calling Stream with new returns Readable instance', () => {
      assert.instanceOf(new Stream(() => {***REMOVED***), require('stream').Readable)
    ***REMOVED***)

    test('calling Stream without new returns Stream instance', () => {
      assert.instanceOf(Stream(() => {***REMOVED***), Stream)
    ***REMOVED***)

    suite('instantiate:', () => {
      let datastream

      setup(() => {
        datastream = new Stream(spooks.fn({ name: 'read', log: log ***REMOVED***))
      ***REMOVED***)

      test('datastream has _read method', () => {
        assert.isFunction(datastream._read)
      ***REMOVED***)

      test('_read expects no arguments', () => {
        assert.lengthOf(datastream._read, 0)
      ***REMOVED***)

      test('read was not called', () => {
        assert.strictEqual(log.counts.read, 0)
      ***REMOVED***)

      suite('datastream._read:', () => {
        setup(() => {
          datastream._read()
        ***REMOVED***)

        test('read was called once', () => {
          assert.strictEqual(log.counts.read, 1)
          assert.isUndefined(log.these.read[0])
        ***REMOVED***)

        test('read was called correctly', () => {
          assert.lengthOf(log.args.read[0], 0)
        ***REMOVED***)
      ***REMOVED***)
    ***REMOVED***)
  ***REMOVED***)
***REMOVED***)

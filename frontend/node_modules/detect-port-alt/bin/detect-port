#!/usr/bin/env node

'use strict';

const pkg = require('../package');

const args = process.argv.slice(2);
const arg_0 = args[0];

if (!!~['-v', '--version'].indexOf(arg_0)) {
  console.log(pkg.version);
  process.exit(0);
***REMOVED***

const port = parseInt(arg_0, 10);

const main = require('..');

if (!arg_0) {
  const random = Math.floor(9000 + Math.random() * (65535 - 9000));

  main(random, (err, port) => {
    if (err) {
      console.log(`get available port failed with ${err***REMOVED***`);
    ***REMOVED***
    console.log(`get available port ${port***REMOVED*** randomly`);
  ***REMOVED***);
***REMOVED*** else if (isNaN(port)) {
  console.log();
  console.log(`  \u001b[37m${pkg.description***REMOVED***\u001b[0m`);
  console.log();
  console.log('  Usage:');
  console.log();
  console.log(`    ${pkg.name***REMOVED*** [port]`);
  console.log();
  console.log('  Options:');
  console.log();
  console.log('    -v, --version    show version and exit');
  console.log('    -h, --help       output usage information');
  console.log();
  console.log('  Further help:');
  console.log();
  console.log(`    ${pkg.homepage***REMOVED***`);
  console.log();
***REMOVED*** else {
  main(port, (err, _port) => {
    if (err) {
      console.log(`get available port failed with ${err***REMOVED***`);
    ***REMOVED***

    if (port !== _port) {
      console.log(`port ${port***REMOVED*** was occupied`);
    ***REMOVED***
    console.log(`get available port ${_port***REMOVED***`);
  ***REMOVED***);
***REMOVED***

'use strict';
const { unit ***REMOVED*** = require('postcss-value-parser');
const { getArguments ***REMOVED*** = require('cssnano-utils');
const addSpace = require('../lib/addSpace');
const getValue = require('../lib/getValue');
const mathFunctions = require('../lib/mathfunctions.js');
const vendorUnprefixed = require('../lib/vendorUnprefixed.js');

// box-shadow: inset? && <length>{2,4***REMOVED*** && <color>?

/**
 * @param {import('postcss-value-parser').ParsedValue***REMOVED*** parsed
 * @return {string***REMOVED***
 */
module.exports = function normalizeBoxShadow(parsed) {
  let args = getArguments(parsed);

  const normalized = normalize(args);

  if (normalized === false) {
    return parsed.toString();
  ***REMOVED***

  return getValue(normalized);
***REMOVED***;
/**
 * @param {import('postcss-value-parser').Node[][]***REMOVED*** args
 * @return {false | import('postcss-value-parser').Node[][]***REMOVED***
 */
function normalize(args) {
  const list = [];
  let abort = false;
  for (const arg of args) {
    /** @type {import('postcss-value-parser').Node[]***REMOVED*** */
    let val = [];
    /** @type {Record<'inset'|'color', import('postcss-value-parser').Node[]>***REMOVED*** */
    let state = {
      inset: [],
      color: [],
    ***REMOVED***;

    arg.forEach((node) => {
      const { type, value ***REMOVED*** = node;

      if (
        type === 'function' &&
        mathFunctions.has(vendorUnprefixed(value.toLowerCase()))
      ) {
        abort = true;
        return;
      ***REMOVED***

      if (type === 'space') {
        return;
      ***REMOVED***

      if (unit(value)) {
        val = [...val, node, addSpace()];
      ***REMOVED*** else if (value.toLowerCase() === 'inset') {
        state.inset = [...state.inset, node, addSpace()];
      ***REMOVED*** else {
        state.color = [...state.color, node, addSpace()];
      ***REMOVED***
    ***REMOVED***);

    if (abort) {
      return false;
    ***REMOVED***

    list.push([...state.inset, ...val, ...state.color]);
  ***REMOVED***
  return list;
***REMOVED***

"use strict";
Object.defineProperty(exports, "__esModule", { value: true ***REMOVED***);
exports.validateAdditionalItems = void 0;
const codegen_1 = require("../../compile/codegen");
const util_1 = require("../../compile/util");
const error = {
    message: ({ params: { len ***REMOVED*** ***REMOVED***) => (0, codegen_1.str) `must NOT have more than ${len***REMOVED*** items`,
    params: ({ params: { len ***REMOVED*** ***REMOVED***) => (0, codegen_1._) `{limit: ${len***REMOVED******REMOVED***`,
***REMOVED***;
const def = {
    keyword: "additionalItems",
    type: "array",
    schemaType: ["boolean", "object"],
    before: "uniqueItems",
    error,
    code(cxt) {
        const { parentSchema, it ***REMOVED*** = cxt;
        const { items ***REMOVED*** = parentSchema;
        if (!Array.isArray(items)) {
            (0, util_1.checkStrictMode)(it, '"additionalItems" is ignored when "items" is not an array of schemas');
            return;
        ***REMOVED***
        validateAdditionalItems(cxt, items);
    ***REMOVED***,
***REMOVED***;
function validateAdditionalItems(cxt, items) {
    const { gen, schema, data, keyword, it ***REMOVED*** = cxt;
    it.items = true;
    const len = gen.const("len", (0, codegen_1._) `${data***REMOVED***.length`);
    if (schema === false) {
        cxt.setParams({ len: items.length ***REMOVED***);
        cxt.pass((0, codegen_1._) `${len***REMOVED*** <= ${items.length***REMOVED***`);
    ***REMOVED***
    else if (typeof schema == "object" && !(0, util_1.alwaysValidSchema)(it, schema)) {
        const valid = gen.var("valid", (0, codegen_1._) `${len***REMOVED*** <= ${items.length***REMOVED***`); // TODO var
        gen.if((0, codegen_1.not)(valid), () => validateItems(valid));
        cxt.ok(valid);
    ***REMOVED***
    function validateItems(valid) {
        gen.forRange("i", items.length, len, (i) => {
            cxt.subschema({ keyword, dataProp: i, dataPropType: util_1.Type.Num ***REMOVED***, valid);
            if (!it.allErrors)
                gen.if((0, codegen_1.not)(valid), () => gen.break());
        ***REMOVED***);
    ***REMOVED***
***REMOVED***
exports.validateAdditionalItems = validateAdditionalItems;
exports.default = def;
//# sourceMappingURL=additionalItems.js.map
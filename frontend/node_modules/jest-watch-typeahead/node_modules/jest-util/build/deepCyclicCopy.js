'use strict';

Object.defineProperty(exports, '__esModule', {
  value: true
***REMOVED***);
exports.default = deepCyclicCopy;

/**
 * Copyright (c) Facebook, Inc. and its affiliates. All Rights Reserved.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */
const EMPTY = new Set();

function deepCyclicCopy(
  value,
  options = {
    blacklist: EMPTY,
    keepPrototype: false
  ***REMOVED***,
  cycles = new WeakMap()
) {
  if (typeof value !== 'object' || value === null || Buffer.isBuffer(value)) {
    return value;
  ***REMOVED*** else if (cycles.has(value)) {
    return cycles.get(value);
  ***REMOVED*** else if (Array.isArray(value)) {
    return deepCyclicCopyArray(value, options, cycles);
  ***REMOVED*** else {
    return deepCyclicCopyObject(value, options, cycles);
  ***REMOVED***
***REMOVED***

function deepCyclicCopyObject(object, options, cycles) {
  const newObject = options.keepPrototype
    ? Object.create(Object.getPrototypeOf(object))
    : {***REMOVED***;
  const descriptors = Object.getOwnPropertyDescriptors(object);
  cycles.set(object, newObject);
  Object.keys(descriptors).forEach(key => {
    if (options.blacklist && options.blacklist.has(key)) {
      delete descriptors[key];
      return;
    ***REMOVED***

    const descriptor = descriptors[key];

    if (typeof descriptor.value !== 'undefined') {
      descriptor.value = deepCyclicCopy(
        descriptor.value,
        {
          blacklist: EMPTY,
          keepPrototype: options.keepPrototype
        ***REMOVED***,
        cycles
      );
    ***REMOVED***

    descriptor.configurable = true;
  ***REMOVED***);
  return Object.defineProperties(newObject, descriptors);
***REMOVED***

function deepCyclicCopyArray(array, options, cycles) {
  const newArray = options.keepPrototype
    ? new (Object.getPrototypeOf(array).constructor)(array.length)
    : [];
  const length = array.length;
  cycles.set(array, newArray);

  for (let i = 0; i < length; i++) {
    newArray[i] = deepCyclicCopy(
      array[i],
      {
        blacklist: EMPTY,
        keepPrototype: options.keepPrototype
      ***REMOVED***,
      cycles
    );
  ***REMOVED***

  return newArray;
***REMOVED***

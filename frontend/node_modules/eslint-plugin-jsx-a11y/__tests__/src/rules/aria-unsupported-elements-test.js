/**
 * @fileoverview Enforce that elements that do not support ARIA roles,
 *  states and properties do not have those attributes.
 * @author Ethan Cohen
 */

// -----------------------------------------------------------------------------
// Requirements
// -----------------------------------------------------------------------------

import { dom ***REMOVED*** from 'aria-query';
import { RuleTester ***REMOVED*** from 'eslint';
import parserOptionsMapper from '../../__util__/parserOptionsMapper';
import parsers from '../../__util__/helpers/parsers';
import rule from '../../../src/rules/aria-unsupported-elements';

// -----------------------------------------------------------------------------
// Tests
// -----------------------------------------------------------------------------

const ruleTester = new RuleTester();

const errorMessage = (invalidProp) => ({
  message: `This element does not support ARIA roles, states and properties. \
Try removing the prop '${invalidProp***REMOVED***'.`,
  type: 'JSXOpeningElement',
***REMOVED***);

const domElements = dom.keys();
// Generate valid test cases
const roleValidityTests = domElements.map((element) => {
  const isReserved = dom.get(element).reserved || false;
  const role = isReserved ? '' : 'role';

  return {
    code: `<${element***REMOVED*** ${role***REMOVED*** />`,
  ***REMOVED***;
***REMOVED***);

const ariaValidityTests = domElements.map((element) => {
  const isReserved = dom.get(element).reserved || false;
  const aria = isReserved ? '' : 'aria-hidden';

  return {
    code: `<${element***REMOVED*** ${aria***REMOVED*** />`,
  ***REMOVED***;
***REMOVED***).concat({
  code: '<fake aria-hidden />',
  errors: [errorMessage('aria-hidden')],
***REMOVED***);

// Generate invalid test cases.
const invalidRoleValidityTests = domElements
  .filter((element) => dom.get(element).reserved)
  .map((reservedElem) => ({
    code: `<${reservedElem***REMOVED*** role {...props***REMOVED*** />`,
    errors: [errorMessage('role')],
  ***REMOVED***)).concat({
    code: '<Meta aria-hidden />',
    errors: [errorMessage('aria-hidden')],
    settings: { 'jsx-a11y': { components: { Meta: 'meta' ***REMOVED*** ***REMOVED*** ***REMOVED***,
  ***REMOVED***);

const invalidAriaValidityTests = domElements
  .filter((element) => dom.get(element).reserved)
  .map((reservedElem) => ({
    code: `<${reservedElem***REMOVED*** aria-hidden aria-role="none" {...props***REMOVED*** />`,
    errors: [errorMessage('aria-hidden')],
  ***REMOVED***));

ruleTester.run('aria-unsupported-elements', rule, {
  valid: parsers.all([].concat(roleValidityTests, ariaValidityTests)).map(parserOptionsMapper),
  invalid: parsers.all([].concat(invalidRoleValidityTests, invalidAriaValidityTests))
    .map(parserOptionsMapper),
***REMOVED***);

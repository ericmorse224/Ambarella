'use strict';

const JSON5 = require('json5');

const specialValues = {
  null: null,
  true: true,
  false: false,
***REMOVED***;

function parseQuery(query) {
  if (query.substr(0, 1) !== '?') {
    throw new Error(
      "A valid query string passed to parseQuery should begin with '?'"
    );
  ***REMOVED***

  query = query.substr(1);

  if (!query) {
    return {***REMOVED***;
  ***REMOVED***

  if (query.substr(0, 1) === '{' && query.substr(-1) === '***REMOVED***') {
    return JSON5.parse(query);
  ***REMOVED***

  const queryArgs = query.split(/[,&]/g);
  const result = Object.create(null);

  queryArgs.forEach((arg) => {
    const idx = arg.indexOf('=');

    if (idx >= 0) {
      let name = arg.substr(0, idx);
      let value = decodeURIComponent(arg.substr(idx + 1));

      // eslint-disable-next-line no-prototype-builtins
      if (specialValues.hasOwnProperty(value)) {
        value = specialValues[value];
      ***REMOVED***

      if (name.substr(-2) === '[]') {
        name = decodeURIComponent(name.substr(0, name.length - 2));

        if (!Array.isArray(result[name])) {
          result[name] = [];
        ***REMOVED***

        result[name].push(value);
      ***REMOVED*** else {
        name = decodeURIComponent(name);
        result[name] = value;
      ***REMOVED***
    ***REMOVED*** else {
      if (arg.substr(0, 1) === '-') {
        result[decodeURIComponent(arg.substr(1))] = false;
      ***REMOVED*** else if (arg.substr(0, 1) === '+') {
        result[decodeURIComponent(arg.substr(1))] = true;
      ***REMOVED*** else {
        result[decodeURIComponent(arg)] = true;
      ***REMOVED***
    ***REMOVED***
  ***REMOVED***);

  return result;
***REMOVED***

module.exports = parseQuery;

'use strict';
const path = require('path');
const pathType = require('path-type');

const getExtensions = extensions => extensions.length > 1 ? `{${extensions.join(',')***REMOVED******REMOVED***` : extensions[0];

const getPath = (filepath, cwd) => {
	const pth = filepath[0] === '!' ? filepath.slice(1) : filepath;
	return path.isAbsolute(pth) ? pth : path.join(cwd, pth);
***REMOVED***;

const addExtensions = (file, extensions) => {
	if (path.extname(file)) {
		return `**/${file***REMOVED***`;
	***REMOVED***

	return `**/${file***REMOVED***.${getExtensions(extensions)***REMOVED***`;
***REMOVED***;

const getGlob = (directory, options) => {
	if (options.files && !Array.isArray(options.files)) {
		throw new TypeError(`Expected \`files\` to be of type \`Array\` but received type \`${typeof options.files***REMOVED***\``);
	***REMOVED***

	if (options.extensions && !Array.isArray(options.extensions)) {
		throw new TypeError(`Expected \`extensions\` to be of type \`Array\` but received type \`${typeof options.extensions***REMOVED***\``);
	***REMOVED***

	if (options.files && options.extensions) {
		return options.files.map(x => path.posix.join(directory, addExtensions(x, options.extensions)));
	***REMOVED***

	if (options.files) {
		return options.files.map(x => path.posix.join(directory, `**/${x***REMOVED***`));
	***REMOVED***

	if (options.extensions) {
		return [path.posix.join(directory, `**/*.${getExtensions(options.extensions)***REMOVED***`)];
	***REMOVED***

	return [path.posix.join(directory, '**')];
***REMOVED***;

module.exports = async (input, options) => {
	options = {
		cwd: process.cwd(),
		...options
	***REMOVED***;

	if (typeof options.cwd !== 'string') {
		throw new TypeError(`Expected \`cwd\` to be of type \`string\` but received type \`${typeof options.cwd***REMOVED***\``);
	***REMOVED***

	const globs = await Promise.all([].concat(input).map(async x => {
		const isDirectory = await pathType.isDirectory(getPath(x, options.cwd));
		return isDirectory ? getGlob(x, options) : x;
	***REMOVED***));

	return [].concat.apply([], globs); // eslint-disable-line prefer-spread
***REMOVED***;

module.exports.sync = (input, options) => {
	options = {
		cwd: process.cwd(),
		...options
	***REMOVED***;

	if (typeof options.cwd !== 'string') {
		throw new TypeError(`Expected \`cwd\` to be of type \`string\` but received type \`${typeof options.cwd***REMOVED***\``);
	***REMOVED***

	const globs = [].concat(input).map(x => pathType.isDirectorySync(getPath(x, options.cwd)) ? getGlob(x, options) : x);

	return [].concat.apply([], globs); // eslint-disable-line prefer-spread
***REMOVED***;

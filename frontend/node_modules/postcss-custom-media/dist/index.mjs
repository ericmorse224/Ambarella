import e from"postcss-value-parser";import t from"fs";import n from"path";import{parse as s***REMOVED***from"postcss";function r(e,t){const n=[];let s="",r=!1,o=0,u=-1;for(;++u<e.length;){const f=e[u];"("===f?o+=1:")"===f?o>0&&(o-=1):0===o&&(t&&c.test(s+f)?r=!0:t||","!==f||(r=!0)),r?(n.push(t?new a(s+f):new i(s)),s="",r=!1):s+=f***REMOVED***return""!==s&&n.push(t?new a(s):new i(s)),n***REMOVED***class o{constructor(e){this.nodes=r(e)***REMOVED***invert(){return this.nodes.forEach((e=>{e.invert()***REMOVED***)),this***REMOVED***clone(){return new o(String(this))***REMOVED***toString(){return this.nodes.join(",")***REMOVED******REMOVED***class i{constructor(e){const[,t,n,s]=e.match(u),[,o="",i=" ",a="",c="",d="",m="",p="",l=""]=n.match(f)||[],w={before:t,after:s,afterModifier:i,originalModifier:o||"",beforeAnd:c,and:d,beforeExpression:m***REMOVED***,h=r(p||l,!0);Object.assign(this,{modifier:o,type:a,raws:w,nodes:h***REMOVED***)***REMOVED***clone(e){const t=new i(String(this));return Object.assign(t,e),t***REMOVED***invert(){return this.modifier=this.modifier?"":this.raws.originalModifier,this***REMOVED***toString(){const{raws:e***REMOVED***=this;return`${e.before***REMOVED***${this.modifier***REMOVED***${this.modifier?`${e.afterModifier***REMOVED***`:""***REMOVED***${this.type***REMOVED***${e.beforeAnd***REMOVED***${e.and***REMOVED***${e.beforeExpression***REMOVED***${this.nodes.join("")***REMOVED***${this.raws.after***REMOVED***`***REMOVED******REMOVED***class a{constructor(e){const[,t,n="",s="",r=""]=e.match(c)||[null,e],o={after:n,and:s,afterAnd:r***REMOVED***;Object.assign(this,{value:t,raws:o***REMOVED***)***REMOVED***clone(e){const t=new a(String(this));return Object.assign(t,e),t***REMOVED***toString(){const{raws:e***REMOVED***=this;return`${this.value***REMOVED***${e.after***REMOVED***${e.and***REMOVED***${e.afterAnd***REMOVED***`***REMOVED******REMOVED***const c=new RegExp("^([\\W\\w]+)(?:(?:(\\s+)(and))(\\s+))$","i"),u=new RegExp("^(\\s*)([\\W\\w]*)(\\s*)$"),f=new RegExp("^(?:(not|only)(\\s+))?(?:(all|print|screen|speech)(?:(?:(\\s+)(and))(\\s+)([\\W\\w]+))?|([\\W\\w]+))$","i");var d=e=>new o(e),m=(t,n)=>{const s={***REMOVED***;return t.nodes.slice().forEach((t=>{if("atrule"!==t.type)return;if("custom-media"!==t.name.toLowerCase())return;let r=null;try{r=e(t.params)***REMOVED***catch(e){return***REMOVED***if(!r||!r.nodes||!r.nodes.length)return;let o=-1;for(let e=0;e<r.nodes.length;e++){const t=r.nodes[e];if("space"!==t.type&&"comment"!==t.type){if("word"===t.type&&t.value.startsWith("--")){o=e;break***REMOVED***return***REMOVED******REMOVED***if(o<0)return;const i=r.nodes[o].value.trim(),a=e.stringify(r.nodes.slice(o+1)).trim();s[i]=d(a),Object(n).preserve||t.remove()***REMOVED***)),s***REMOVED***;function p(e){const t=Object.assign({***REMOVED***,Object(e).customMedia,Object(e)["custom-media"]);for(const e in t)t[e]=d(t[e]);return t***REMOVED***function l(e){return e.map((e=>{if(e instanceof Promise)return e;if(e instanceof Function)return e();const t=e===Object(e)?e:{from:String(e)***REMOVED***;if(Object(t).customMedia||Object(t)["custom-media"])return t;const s=n.resolve(String(t.from||""));return{type:(t.type||n.extname(s).slice(1)).toLowerCase(),from:s***REMOVED******REMOVED***)).reduce((async(e,t)=>{const{type:n,from:r***REMOVED***=await t;return"css"===n||"pcss"===n?Object.assign(await e,await async function(e){const t=await w(e),n=s(t,{from:e***REMOVED***);return m(n,{preserve:!0***REMOVED***)***REMOVED***(r)):"js"===n?Object.assign(await e,await async function(e){return p(await import(e))***REMOVED***(r)):"json"===n?Object.assign(await e,await async function(e){return p(await h(e))***REMOVED***(r)):Object.assign(await e,p(await t))***REMOVED***),{***REMOVED***)***REMOVED***const w=e=>new Promise(((n,s)=>{t.readFile(e,"utf8",((e,t)=>{e?s(e):n(t)***REMOVED***))***REMOVED***)),h=async e=>JSON.parse(await w(e));function g(t){if(!t)return;let n=null;try{n=e(t)***REMOVED***catch(e){return***REMOVED***if(!n||!n.nodes||!n.nodes.length)return;if(1!==n.nodes.length)return;for(;"function"===n.nodes[0].type&&""===n.nodes[0].value;)n=n.nodes[0];let s=-1;for(let e=0;e<n.nodes.length;e++){const t=n.nodes[e];if("space"!==t.type&&"comment"!==t.type){if("word"===t.type&&t.value.startsWith("--")){s=e;break***REMOVED***return***REMOVED******REMOVED***return s<0?void 0:n.nodes[s].value.trim()***REMOVED***function y(e,t){let n=e.nodes.length-1;for(;n>=0;){const s=b(e.nodes[n],t);s.length&&e.nodes.splice(n,1,...s),--n***REMOVED***return e***REMOVED***function b(e,t){const n=[];for(const s in e.nodes){const{value:r,nodes:o***REMOVED***=e.nodes[s],i=g(r);if(i&&i in t){for(const r of t[i].nodes){const o=e.modifier!==r.modifier?e.modifier||r.modifier:"",a=e.clone({modifier:o,raws:!o||e.modifier?{...e.raws***REMOVED***:{...r.raws***REMOVED***,type:e.type||r.type***REMOVED***);a.type===r.type&&Object.assign(a.raws,{and:r.raws.and,beforeAnd:r.raws.beforeAnd,beforeExpression:r.raws.beforeExpression***REMOVED***),a.nodes.splice(s,1,...r.clone().nodes.map((t=>(e.nodes[s].raws.and&&(t.raws={...e.nodes[s].raws***REMOVED***),t.spaces={...e.nodes[s].spaces***REMOVED***,t))));const c=b(a,j(t,i));c.length?n.push(...c):n.push(a)***REMOVED***return n***REMOVED***o&&o.length&&y(e.nodes[s],t)***REMOVED***return n***REMOVED***const j=(e,t)=>{const n=Object.assign({***REMOVED***,e);return delete n[t],n***REMOVED***;function O(e,t){return Promise.all(t.map((async t=>{if(t instanceof Function)await t($(e));else{const s=t===Object(t)?t:{to:String(t)***REMOVED***,r=s.toJSON||$;if("customMedia"in s)s.customMedia=r(e);else if("custom-media"in s)s["custom-media"]=r(e);else{const t=String(s.to||""),o=(s.type||n.extname(t).slice(1)).toLowerCase(),i=r(e);"css"===o&&await async function(e,t){const n=`${Object.keys(t).reduce(((e,n)=>(e.push(`@custom-media ${n***REMOVED*** ${t[n]***REMOVED***;`),e)),[]).join("\n")***REMOVED***\n`;await v(e,n)***REMOVED***(t,i),"js"===o&&await async function(e,t){const n=`module.exports = {\n\tcustomMedia: {\n${Object.keys(t).reduce(((e,n)=>(e.push(`\t\t'${S(n)***REMOVED***': '${S(t[n])***REMOVED***'`),e)),[]).join(",\n")***REMOVED***\n\t***REMOVED***\n***REMOVED***;\n`;await v(e,n)***REMOVED***(t,i),"json"===o&&await async function(e,t){const n=`${JSON.stringify({"custom-media":t***REMOVED***,null,"\t")***REMOVED***\n`;await v(e,n)***REMOVED***(t,i),"mjs"===o&&await async function(e,t){const n=`export const customMedia = {\n${Object.keys(t).reduce(((e,n)=>(e.push(`\t'${S(n)***REMOVED***': '${S(t[n])***REMOVED***'`),e)),[]).join(",\n")***REMOVED***\n***REMOVED***;\n`;await v(e,n)***REMOVED***(t,i)***REMOVED******REMOVED******REMOVED***)))***REMOVED***const $=e=>Object.keys(e).reduce(((t,n)=>(t[n]=String(e[n]),t)),{***REMOVED***),v=(e,n)=>new Promise(((s,r)=>{t.writeFile(e,n,(e=>{e?r(e):s()***REMOVED***))***REMOVED***)),S=e=>e.replace(/\\([\s\S])|(')/g,"\\$1$2").replace(/\n/g,"\\n").replace(/\r/g,"\\r"),x=e=>{const t="preserve"in Object(e)&&Boolean(e.preserve),n=[].concat(Object(e).importFrom||[]),s=[].concat(Object(e).exportTo||[]),r=l(n),o=Symbol("customMediaHelper");return{postcssPlugin:"postcss-custom-media",Once:async(e,n)=>{n[o]=Object.assign(await r,m(e,{preserve:t***REMOVED***)),await O(n[o],s)***REMOVED***,AtRule:(e,n)=>{"media"===e.name&&((e,t,{preserve:n***REMOVED***)=>{if(e.params.indexOf("--")>-1){const s=d(e.params),r=String(y(s,t));if(null===r)return;if(r===e.params)return;e.cloneBefore({params:r***REMOVED***),n||e.remove()***REMOVED******REMOVED***)(e,n[o],{preserve:t***REMOVED***)***REMOVED******REMOVED******REMOVED***;x.postcss=!0;export{x as default***REMOVED***;

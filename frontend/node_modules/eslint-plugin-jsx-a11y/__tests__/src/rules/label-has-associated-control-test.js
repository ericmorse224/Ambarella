/**
 * @fileoverview Enforce label tags have an associated control.
 * @author Jesse Beach
 */

// -----------------------------------------------------------------------------
// Requirements
// -----------------------------------------------------------------------------

import { RuleTester ***REMOVED*** from 'eslint';
import parserOptionsMapper from '../../__util__/parserOptionsMapper';
import parsers from '../../__util__/helpers/parsers';
import rule from '../../../src/rules/label-has-associated-control';
import ruleOptionsMapperFactory from '../../__util__/ruleOptionsMapperFactory';

// -----------------------------------------------------------------------------
// Tests
// -----------------------------------------------------------------------------

const ruleTester = new RuleTester();

const ruleName = 'label-has-associated-control';

const expectedError = {
  message: 'A form label must be associated with a control.',
  type: 'JSXOpeningElement',
***REMOVED***;

const expectedErrorNoLabel = {
  message: 'A form label must have accessible text.',
  type: 'JSXOpeningElement',
***REMOVED***;

const componentsSettings = {
  'jsx-a11y': {
    components: {
      CustomInput: 'input',
      CustomLabel: 'label',
    ***REMOVED***,
  ***REMOVED***,
***REMOVED***;

const attributesSettings = {
  'jsx-a11y': {
    attributes: {
      for: ['htmlFor', 'for'],
    ***REMOVED***,
  ***REMOVED***,
***REMOVED***;

const htmlForValid = [
  { code: '<label htmlFor="js_id"><span><span><span>A label</span></span></span></label>', options: [{ depth: 4 ***REMOVED***] ***REMOVED***,
  { code: '<label htmlFor="js_id" aria-label="A label" />' ***REMOVED***,
  { code: '<label htmlFor="js_id" aria-labelledby="A label" />' ***REMOVED***,
  { code: '<div><label htmlFor="js_id">A label</label><input id="js_id" /></div>' ***REMOVED***,
  { code: '<label for="js_id"><span><span><span>A label</span></span></span></label>', options: [{ depth: 4 ***REMOVED***], settings: attributesSettings ***REMOVED***,
  { code: '<label for="js_id" aria-label="A label" />', settings: attributesSettings ***REMOVED***,
  { code: '<label for="js_id" aria-labelledby="A label" />', settings: attributesSettings ***REMOVED***,
  { code: '<div><label for="js_id">A label</label><input id="js_id" /></div>', settings: attributesSettings ***REMOVED***,
  // Custom label component.
  { code: '<CustomLabel htmlFor="js_id" aria-label="A label" />', options: [{ labelComponents: ['CustomLabel'] ***REMOVED***] ***REMOVED***,
  { code: '<CustomLabel htmlFor="js_id" label="A label" />', options: [{ labelAttributes: ['label'], labelComponents: ['CustomLabel'] ***REMOVED***] ***REMOVED***,
  { code: '<CustomLabel htmlFor="js_id" aria-label="A label" />', settings: componentsSettings ***REMOVED***,
  // Custom label attributes.
  { code: '<label htmlFor="js_id" label="A label" />', options: [{ labelAttributes: ['label'] ***REMOVED***] ***REMOVED***,
  // Glob support for controlComponents option.
  { code: '<CustomLabel htmlFor="js_id" aria-label="A label" />', options: [{ controlComponents: ['Custom*'] ***REMOVED***] ***REMOVED***,
  { code: '<CustomLabel htmlFor="js_id" aria-label="A label" />', options: [{ controlComponents: ['*Label'] ***REMOVED***] ***REMOVED***,
  // Rule does not error if presence of accessible label cannot be determined
  { code: '<div><label htmlFor="js_id"><CustomText /></label><input id="js_id" /></div>' ***REMOVED***,
];
const nestingValid = [
  { code: '<label>A label<input /></label>' ***REMOVED***,
  { code: '<label>A label<textarea /></label>' ***REMOVED***,
  { code: '<label><img alt="A label" /><input /></label>' ***REMOVED***,
  { code: '<label><img aria-label="A label" /><input /></label>' ***REMOVED***,
  { code: '<label><span>A label<input /></span></label>' ***REMOVED***,
  { code: '<label><span><span>A label<input /></span></span></label>', options: [{ depth: 3 ***REMOVED***] ***REMOVED***,
  { code: '<label><span><span><span>A label<input /></span></span></span></label>', options: [{ depth: 4 ***REMOVED***] ***REMOVED***,
  { code: '<label><span><span><span><span>A label</span><input /></span></span></span></label>', options: [{ depth: 5 ***REMOVED***] ***REMOVED***,
  { code: '<label><span><span><span><span aria-label="A label" /><input /></span></span></span></label>', options: [{ depth: 5 ***REMOVED***] ***REMOVED***,
  { code: '<label><span><span><span><input aria-label="A label" /></span></span></span></label>', options: [{ depth: 5 ***REMOVED***] ***REMOVED***,
  // Other controls
  { code: '<label>foo<meter /></label>' ***REMOVED***,
  { code: '<label>foo<output /></label>' ***REMOVED***,
  { code: '<label>foo<progress /></label>' ***REMOVED***,
  { code: '<label>foo<textarea /></label>' ***REMOVED***,
  // Custom controlComponents.
  { code: '<label>A label<CustomInput /></label>', options: [{ controlComponents: ['CustomInput'] ***REMOVED***] ***REMOVED***,
  { code: '<label><span>A label<CustomInput /></span></label>', options: [{ controlComponents: ['CustomInput'] ***REMOVED***] ***REMOVED***,
  { code: '<label><span>A label<CustomInput /></span></label>', settings: componentsSettings ***REMOVED***,
  { code: '<CustomLabel><span>A label<CustomInput /></span></CustomLabel>', options: [{ controlComponents: ['CustomInput'], labelComponents: ['CustomLabel'] ***REMOVED***] ***REMOVED***,
  { code: '<CustomLabel><span label="A label"><CustomInput /></span></CustomLabel>', options: [{ controlComponents: ['CustomInput'], labelComponents: ['CustomLabel'], labelAttributes: ['label'] ***REMOVED***] ***REMOVED***,
  // Glob support for controlComponents option.
  { code: '<label><span>A label<CustomInput /></span></label>', options: [{ controlComponents: ['Custom*'] ***REMOVED***] ***REMOVED***,
  { code: '<label><span>A label<CustomInput /></span></label>', options: [{ controlComponents: ['*Input'] ***REMOVED***] ***REMOVED***,
  // Rule does not error if presence of accessible label cannot be determined
  { code: '<label><CustomText /><input /></label>' ***REMOVED***,
];

const bothValid = [
  { code: '<label htmlFor="js_id"><span><span><span>A label<input /></span></span></span></label>', options: [{ depth: 4 ***REMOVED***] ***REMOVED***,
  { code: '<label htmlFor="js_id" aria-label="A label"><input /></label>' ***REMOVED***,
  { code: '<label htmlFor="js_id" aria-labelledby="A label"><input /></label>' ***REMOVED***,
  { code: '<label htmlFor="js_id" aria-labelledby="A label"><textarea /></label>' ***REMOVED***,
  // Custom label component.
  { code: '<CustomLabel htmlFor="js_id" aria-label="A label"><input /></CustomLabel>', options: [{ labelComponents: ['CustomLabel'] ***REMOVED***] ***REMOVED***,
  { code: '<CustomLabel htmlFor="js_id" label="A label"><input /></CustomLabel>', options: [{ labelAttributes: ['label'], labelComponents: ['CustomLabel'] ***REMOVED***] ***REMOVED***,
  { code: '<CustomLabel htmlFor="js_id" aria-label="A label"><input /></CustomLabel>', settings: componentsSettings ***REMOVED***,
  { code: '<CustomLabel htmlFor="js_id" aria-label="A label"><CustomInput /></CustomLabel>', settings: componentsSettings ***REMOVED***,
  // Custom label attributes.
  { code: '<label htmlFor="js_id" label="A label"><input /></label>', options: [{ labelAttributes: ['label'] ***REMOVED***] ***REMOVED***,
  { code: '<label htmlFor="selectInput">Some text<select id="selectInput" /></label>' ***REMOVED***,
];

const alwaysValid = [
  { code: '<div />' ***REMOVED***,
  { code: '<CustomElement />' ***REMOVED***,
  { code: '<input type="hidden" />' ***REMOVED***,
];

const htmlForInvalid = [
  { code: '<label htmlFor="js_id"><span><span><span>A label</span></span></span></label>', options: [{ depth: 4 ***REMOVED***], errors: [expectedError] ***REMOVED***,
  { code: '<label htmlFor="js_id" aria-label="A label" />', errors: [expectedError] ***REMOVED***,
  { code: '<label htmlFor="js_id" aria-labelledby="A label" />', errors: [expectedError] ***REMOVED***,
  // Custom label component.
  { code: '<CustomLabel htmlFor="js_id" aria-label="A label" />', options: [{ labelComponents: ['CustomLabel'] ***REMOVED***], errors: [expectedError] ***REMOVED***,
  { code: '<CustomLabel htmlFor="js_id" label="A label" />', options: [{ labelAttributes: ['label'], labelComponents: ['CustomLabel'] ***REMOVED***], errors: [expectedError] ***REMOVED***,
  { code: '<CustomLabel htmlFor="js_id" aria-label="A label" />', settings: componentsSettings, errors: [expectedError] ***REMOVED***,
  // Custom label attributes.
  { code: '<label htmlFor="js_id" label="A label" />', options: [{ labelAttributes: ['label'] ***REMOVED***], errors: [expectedError] ***REMOVED***,
];
const nestingInvalid = [
  { code: '<label>A label<input /></label>', errors: [expectedError] ***REMOVED***,
  { code: '<label>A label<textarea /></label>', errors: [expectedError] ***REMOVED***,
  { code: '<label><img alt="A label" /><input /></label>', errors: [expectedError] ***REMOVED***,
  { code: '<label><img aria-label="A label" /><input /></label>', errors: [expectedError] ***REMOVED***,
  { code: '<label><span>A label<input /></span></label>', errors: [expectedError] ***REMOVED***,
  { code: '<label><span><span>A label<input /></span></span></label>', options: [{ depth: 3 ***REMOVED***], errors: [expectedError] ***REMOVED***,
  { code: '<label><span><span><span>A label<input /></span></span></span></label>', options: [{ depth: 4 ***REMOVED***], errors: [expectedError] ***REMOVED***,
  { code: '<label><span><span><span><span>A label</span><input /></span></span></span></label>', options: [{ depth: 5 ***REMOVED***], errors: [expectedError] ***REMOVED***,
  { code: '<label><span><span><span><span aria-label="A label" /><input /></span></span></span></label>', options: [{ depth: 5 ***REMOVED***], errors: [expectedError] ***REMOVED***,
  { code: '<label><span><span><span><input aria-label="A label" /></span></span></span></label>', options: [{ depth: 5 ***REMOVED***], errors: [expectedError] ***REMOVED***,
  // Custom controlComponents.
  { code: '<label>A label<OtherCustomInput /></label>', options: [{ controlComponents: ['CustomInput'] ***REMOVED***], errors: [expectedError] ***REMOVED***,
  { code: '<label><span>A label<CustomInput /></span></label>', options: [{ controlComponents: ['CustomInput'] ***REMOVED***], errors: [expectedError] ***REMOVED***,
  { code: '<CustomLabel><span>A label<CustomInput /></span></CustomLabel>', options: [{ controlComponents: ['CustomInput'], labelComponents: ['CustomLabel'] ***REMOVED***], errors: [expectedError] ***REMOVED***,
  { code: '<CustomLabel><span label="A label"><CustomInput /></span></CustomLabel>', options: [{ controlComponents: ['CustomInput'], labelComponents: ['CustomLabel'], labelAttributes: ['label'] ***REMOVED***], errors: [expectedError] ***REMOVED***,
  { code: '<label><span>A label<CustomInput /></span></label>', settings: componentsSettings, errors: [expectedError] ***REMOVED***,
  { code: '<CustomLabel><span>A label<CustomInput /></span></CustomLabel>', settings: componentsSettings, errors: [expectedError] ***REMOVED***,
];

const neverValid = [
  { code: '<label htmlFor="js_id" />', errors: [expectedErrorNoLabel] ***REMOVED***,
  { code: '<label htmlFor="js_id"><input /></label>', errors: [expectedErrorNoLabel] ***REMOVED***,
  { code: '<label htmlFor="js_id"><textarea /></label>', errors: [expectedErrorNoLabel] ***REMOVED***,
  { code: '<label></label>', errors: [expectedErrorNoLabel] ***REMOVED***,
  { code: '<label>A label</label>', errors: [expectedError] ***REMOVED***,
  { code: '<div><label /><input /></div>', errors: [expectedErrorNoLabel] ***REMOVED***,
  { code: '<div><label>A label</label><input /></div>', errors: [expectedError] ***REMOVED***,
  // Custom label component.
  { code: '<CustomLabel aria-label="A label" />', options: [{ labelComponents: ['CustomLabel'] ***REMOVED***], errors: [expectedError] ***REMOVED***,
  { code: '<CustomLabel label="A label" />', options: [{ labelAttributes: ['label'], labelComponents: ['CustomLabel'] ***REMOVED***], errors: [expectedError] ***REMOVED***,
  { code: '<CustomLabel aria-label="A label" />', settings: componentsSettings, errors: [expectedError] ***REMOVED***,
  // Custom label attributes.
  { code: '<label label="A label" />', options: [{ labelAttributes: ['label'] ***REMOVED***], errors: [expectedError] ***REMOVED***,
  // Custom controlComponents.
  { code: '<label><span><CustomInput /></span></label>', options: [{ controlComponents: ['CustomInput'] ***REMOVED***], errors: [expectedErrorNoLabel] ***REMOVED***,
  { code: '<CustomLabel><span><CustomInput /></span></CustomLabel>', options: [{ controlComponents: ['CustomInput'], labelComponents: ['CustomLabel'] ***REMOVED***], errors: [expectedErrorNoLabel] ***REMOVED***,
  { code: '<CustomLabel><span><CustomInput /></span></CustomLabel>', options: [{ controlComponents: ['CustomInput'], labelComponents: ['CustomLabel'], labelAttributes: ['label'] ***REMOVED***], errors: [expectedErrorNoLabel] ***REMOVED***,
  { code: '<label><span><CustomInput /></span></label>', settings: componentsSettings, errors: [expectedErrorNoLabel] ***REMOVED***,
  { code: '<CustomLabel><span><CustomInput /></span></CustomLabel>', settings: componentsSettings, errors: [expectedErrorNoLabel] ***REMOVED***,
];
// htmlFor valid
ruleTester.run(ruleName, rule, {
  valid: parsers.all([].concat(
    ...alwaysValid,
    ...htmlForValid,
  ))
    .map(ruleOptionsMapperFactory({
      assert: 'htmlFor',
    ***REMOVED***))
    .map(parserOptionsMapper),
  invalid: parsers.all([].concat(
    ...neverValid,
    ...nestingInvalid,
  ))
    .map(ruleOptionsMapperFactory({
      assert: 'htmlFor',
    ***REMOVED***))
    .map(parserOptionsMapper),
***REMOVED***);

// nesting valid
ruleTester.run(ruleName, rule, {
  valid: parsers.all([].concat(
    ...alwaysValid,
    ...nestingValid,
  ))
    .map(ruleOptionsMapperFactory({
      assert: 'nesting',
    ***REMOVED***))
    .map(parserOptionsMapper),
  invalid: parsers.all([].concat(
    ...neverValid,
    ...htmlForInvalid,
  ))
    .map(ruleOptionsMapperFactory({
      assert: 'nesting',
    ***REMOVED***))
    .map(parserOptionsMapper),
***REMOVED***);

// either valid
ruleTester.run(ruleName, rule, {
  valid: parsers.all([].concat(
    ...alwaysValid,
    ...htmlForValid,
    ...nestingValid,
  ))
    .map(ruleOptionsMapperFactory({
      assert: 'either',
    ***REMOVED***))
    .map(parserOptionsMapper),
  invalid: parsers.all([].concat(
    ...neverValid,
  )).map(parserOptionsMapper),
***REMOVED***);

// both valid
ruleTester.run(ruleName, rule, {
  valid: parsers.all([].concat(
    ...alwaysValid,
    ...bothValid,
  ))
    .map(ruleOptionsMapperFactory({
      assert: 'both',
    ***REMOVED***))
    .map(parserOptionsMapper),
  invalid: parsers.all([].concat(
    ...neverValid,
  )).map(parserOptionsMapper),
***REMOVED***);

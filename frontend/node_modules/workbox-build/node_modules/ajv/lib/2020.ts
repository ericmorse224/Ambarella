import type {AnySchemaObject***REMOVED*** from "./types"
import AjvCore, {Options***REMOVED*** from "./core"

import draft2020Vocabularies from "./vocabularies/draft2020"
import discriminator from "./vocabularies/discriminator"
import addMetaSchema2020 from "./refs/json-schema-2020-12"

const META_SCHEMA_ID = "https://json-schema.org/draft/2020-12/schema"

export class Ajv2020 extends AjvCore {
  constructor(opts: Options = {***REMOVED***) {
    super({
      ...opts,
      dynamicRef: true,
      next: true,
      unevaluated: true,
    ***REMOVED***)
  ***REMOVED***

  _addVocabularies(): void {
    super._addVocabularies()
    draft2020Vocabularies.forEach((v) => this.addVocabulary(v))
    if (this.opts.discriminator) this.addKeyword(discriminator)
  ***REMOVED***

  _addDefaultMetaSchema(): void {
    super._addDefaultMetaSchema()
    const {$data, meta***REMOVED*** = this.opts
    if (!meta) return
    addMetaSchema2020.call(this, $data)
    this.refs["http://json-schema.org/schema"] = META_SCHEMA_ID
  ***REMOVED***

  defaultMeta(): string | AnySchemaObject | undefined {
    return (this.opts.defaultMeta =
      super.defaultMeta() || (this.getSchema(META_SCHEMA_ID) ? META_SCHEMA_ID : undefined))
  ***REMOVED***
***REMOVED***

module.exports = exports = Ajv2020
module.exports.Ajv2020 = Ajv2020
Object.defineProperty(exports, "__esModule", {value: true***REMOVED***)

export default Ajv2020

export {
  Format,
  FormatDefinition,
  AsyncFormatDefinition,
  KeywordDefinition,
  KeywordErrorDefinition,
  CodeKeywordDefinition,
  MacroKeywordDefinition,
  FuncKeywordDefinition,
  Vocabulary,
  Schema,
  SchemaObject,
  AnySchemaObject,
  AsyncSchema,
  AnySchema,
  ValidateFunction,
  AsyncValidateFunction,
  ErrorObject,
  ErrorNoParams,
***REMOVED*** from "./types"

export {Plugin, Options, CodeOptions, InstanceOptions, Logger, ErrorsTextOptions***REMOVED*** from "./core"
export {SchemaCxt, SchemaObjCxt***REMOVED*** from "./compile"
export {KeywordCxt***REMOVED*** from "./compile/validate"
export {DefinedError***REMOVED*** from "./vocabularies/errors"
export {JSONType***REMOVED*** from "./compile/rules"
export {JSONSchemaType***REMOVED*** from "./types/json-schema"
export {_, str, stringify, nil, Name, Code, CodeGen, CodeGenOptions***REMOVED*** from "./compile/codegen"
export {default as ValidationError***REMOVED*** from "./runtime/validation_error"
export {default as MissingRefError***REMOVED*** from "./compile/ref_error"

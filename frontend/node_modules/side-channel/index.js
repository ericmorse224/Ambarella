'use strict';

var $TypeError = require('es-errors/type');
var inspect = require('object-inspect');
var getSideChannelList = require('side-channel-list');
var getSideChannelMap = require('side-channel-map');
var getSideChannelWeakMap = require('side-channel-weakmap');

var makeChannel = getSideChannelWeakMap || getSideChannelMap || getSideChannelList;

/** @type {import('.')***REMOVED*** */
module.exports = function getSideChannel() {
	/** @typedef {ReturnType<typeof getSideChannel>***REMOVED*** Channel */

	/** @type {Channel | undefined***REMOVED*** */ var $channelData;

	/** @type {Channel***REMOVED*** */
	var channel = {
		assert: function (key) {
			if (!channel.has(key)) {
				throw new $TypeError('Side channel does not contain ' + inspect(key));
			***REMOVED***
		***REMOVED***,
		'delete': function (key) {
			return !!$channelData && $channelData['delete'](key);
		***REMOVED***,
		get: function (key) {
			return $channelData && $channelData.get(key);
		***REMOVED***,
		has: function (key) {
			return !!$channelData && $channelData.has(key);
		***REMOVED***,
		set: function (key, value) {
			if (!$channelData) {
				$channelData = makeChannel();
			***REMOVED***

			$channelData.set(key, value);
		***REMOVED***
	***REMOVED***;
	// @ts-expect-error TODO: figure out why this is erroring
	return channel;
***REMOVED***;

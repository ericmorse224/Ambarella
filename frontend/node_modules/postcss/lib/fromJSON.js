'use strict'

let AtRule = require('./at-rule')
let Comment = require('./comment')
let Declaration = require('./declaration')
let Input = require('./input')
let PreviousMap = require('./previous-map')
let Root = require('./root')
let Rule = require('./rule')

function fromJSON(json, inputs) {
  if (Array.isArray(json)) return json.map(n => fromJSON(n))

  let { inputs: ownInputs, ...defaults ***REMOVED*** = json
  if (ownInputs) {
    inputs = []
    for (let input of ownInputs) {
      let inputHydrated = { ...input, __proto__: Input.prototype ***REMOVED***
      if (inputHydrated.map) {
        inputHydrated.map = {
          ...inputHydrated.map,
          __proto__: PreviousMap.prototype
        ***REMOVED***
      ***REMOVED***
      inputs.push(inputHydrated)
    ***REMOVED***
  ***REMOVED***
  if (defaults.nodes) {
    defaults.nodes = json.nodes.map(n => fromJSON(n, inputs))
  ***REMOVED***
  if (defaults.source) {
    let { inputId, ...source ***REMOVED*** = defaults.source
    defaults.source = source
    if (inputId != null) {
      defaults.source.input = inputs[inputId]
    ***REMOVED***
  ***REMOVED***
  if (defaults.type === 'root') {
    return new Root(defaults)
  ***REMOVED*** else if (defaults.type === 'decl') {
    return new Declaration(defaults)
  ***REMOVED*** else if (defaults.type === 'rule') {
    return new Rule(defaults)
  ***REMOVED*** else if (defaults.type === 'comment') {
    return new Comment(defaults)
  ***REMOVED*** else if (defaults.type === 'atrule') {
    return new AtRule(defaults)
  ***REMOVED*** else {
    throw new Error('Unknown node type: ' + json.type)
  ***REMOVED***
***REMOVED***

module.exports = fromJSON
fromJSON.default = fromJSON

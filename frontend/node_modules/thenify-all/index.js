
var thenify = require('thenify')

module.exports = thenifyAll
thenifyAll.withCallback = withCallback
thenifyAll.thenify = thenify

/**
 * Promisifies all the selected functions in an object.
 *
 * @param {Object***REMOVED*** source the source object for the async functions
 * @param {Object***REMOVED*** [destination] the destination to set all the promisified methods
 * @param {Array***REMOVED*** [methods] an array of method names of `source`
 * @return {Object***REMOVED***
 * @api public
 */

function thenifyAll(source, destination, methods) {
  return promisifyAll(source, destination, methods, thenify)
***REMOVED***

/**
 * Promisifies all the selected functions in an object and backward compatible with callback.
 *
 * @param {Object***REMOVED*** source the source object for the async functions
 * @param {Object***REMOVED*** [destination] the destination to set all the promisified methods
 * @param {Array***REMOVED*** [methods] an array of method names of `source`
 * @return {Object***REMOVED***
 * @api public
 */

function withCallback(source, destination, methods) {
  return promisifyAll(source, destination, methods, thenify.withCallback)
***REMOVED***

function promisifyAll(source, destination, methods, promisify) {
  if (!destination) {
    destination = {***REMOVED***;
    methods = Object.keys(source)
  ***REMOVED***

  if (Array.isArray(destination)) {
    methods = destination
    destination = {***REMOVED***
  ***REMOVED***

  if (!methods) {
    methods = Object.keys(source)
  ***REMOVED***

  if (typeof source === 'function') destination = promisify(source)

  methods.forEach(function (name) {
    // promisify only if it's a function
    if (typeof source[name] === 'function') destination[name] = promisify(source[name])
  ***REMOVED***)

  // proxy the rest
  Object.keys(source).forEach(function (name) {
    if (deprecated(source, name)) return
    if (destination[name]) return
    destination[name] = source[name]
  ***REMOVED***)

  return destination
***REMOVED***

function deprecated(source, name) {
  var desc = Object.getOwnPropertyDescriptor(source, name)
  if (!desc || !desc.get) return false
  if (desc.get.name === 'deprecated') return true
  return false
***REMOVED***

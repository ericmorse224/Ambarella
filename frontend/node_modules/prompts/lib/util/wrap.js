'use strict';

/**
 * @param {string***REMOVED*** msg The message to wrap
 * @param {object***REMOVED*** opts
 * @param {number|string***REMOVED*** [opts.margin] Left margin
 * @param {number***REMOVED*** opts.width Maximum characters per line including the margin
 */
module.exports = (msg, opts = {***REMOVED***) => {
  const tab = Number.isSafeInteger(parseInt(opts.margin))
    ? new Array(parseInt(opts.margin)).fill(' ').join('')
    : (opts.margin || '');

  const width = opts.width;

  return (msg || '').split(/\r?\n/g)
    .map(line => line
      .split(/\s+/g)
      .reduce((arr, w) => {
        if (w.length + tab.length >= width || arr[arr.length - 1].length + w.length + 1 < width)
          arr[arr.length - 1] += ` ${w***REMOVED***`;
        else arr.push(`${tab***REMOVED***${w***REMOVED***`);
        return arr;
      ***REMOVED***, [ tab ])
      .join('\n'))
    .join('\n');
***REMOVED***;

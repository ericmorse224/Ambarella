"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
***REMOVED***);
exports.default = createTemplateBuilder;
var _options = require("./options.js");
var _string = require("./string.js");
var _literal = require("./literal.js");
const NO_PLACEHOLDER = (0, _options.validate)({
  placeholderPattern: false
***REMOVED***);
function createTemplateBuilder(formatter, defaultOpts) {
  const templateFnCache = new WeakMap();
  const templateAstCache = new WeakMap();
  const cachedOpts = defaultOpts || (0, _options.validate)(null);
  return Object.assign((tpl, ...args) => {
    if (typeof tpl === "string") {
      if (args.length > 1) throw new Error("Unexpected extra params.");
      return extendedTrace((0, _string.default)(formatter, tpl, (0, _options.merge)(cachedOpts, (0, _options.validate)(args[0]))));
    ***REMOVED*** else if (Array.isArray(tpl)) {
      let builder = templateFnCache.get(tpl);
      if (!builder) {
        builder = (0, _literal.default)(formatter, tpl, cachedOpts);
        templateFnCache.set(tpl, builder);
      ***REMOVED***
      return extendedTrace(builder(args));
    ***REMOVED*** else if (typeof tpl === "object" && tpl) {
      if (args.length > 0) throw new Error("Unexpected extra params.");
      return createTemplateBuilder(formatter, (0, _options.merge)(cachedOpts, (0, _options.validate)(tpl)));
    ***REMOVED***
    throw new Error(`Unexpected template param ${typeof tpl***REMOVED***`);
  ***REMOVED***, {
    ast: (tpl, ...args) => {
      if (typeof tpl === "string") {
        if (args.length > 1) throw new Error("Unexpected extra params.");
        return (0, _string.default)(formatter, tpl, (0, _options.merge)((0, _options.merge)(cachedOpts, (0, _options.validate)(args[0])), NO_PLACEHOLDER))();
      ***REMOVED*** else if (Array.isArray(tpl)) {
        let builder = templateAstCache.get(tpl);
        if (!builder) {
          builder = (0, _literal.default)(formatter, tpl, (0, _options.merge)(cachedOpts, NO_PLACEHOLDER));
          templateAstCache.set(tpl, builder);
        ***REMOVED***
        return builder(args)();
      ***REMOVED***
      throw new Error(`Unexpected template param ${typeof tpl***REMOVED***`);
    ***REMOVED***
  ***REMOVED***);
***REMOVED***
function extendedTrace(fn) {
  let rootStack = "";
  try {
    throw new Error();
  ***REMOVED*** catch (error) {
    if (error.stack) {
      rootStack = error.stack.split("\n").slice(3).join("\n");
    ***REMOVED***
  ***REMOVED***
  return arg => {
    try {
      return fn(arg);
    ***REMOVED*** catch (err) {
      err.stack += `\n    =============\n${rootStack***REMOVED***`;
      throw err;
    ***REMOVED***
  ***REMOVED***;
***REMOVED***

//# sourceMappingURL=builder.js.map

"use strict";
Object.defineProperty(exports, "__esModule", { value: true ***REMOVED***);
const fsScandir = require("@nodelib/fs.scandir");
const common = require("./common");
const reader_1 = require("./reader");
class SyncReader extends reader_1.default {
    constructor() {
        super(...arguments);
        this._scandir = fsScandir.scandirSync;
        this._storage = [];
        this._queue = new Set();
    ***REMOVED***
    read() {
        this._pushToQueue(this._root, this._settings.basePath);
        this._handleQueue();
        return this._storage;
    ***REMOVED***
    _pushToQueue(directory, base) {
        this._queue.add({ directory, base ***REMOVED***);
    ***REMOVED***
    _handleQueue() {
        for (const item of this._queue.values()) {
            this._handleDirectory(item.directory, item.base);
        ***REMOVED***
    ***REMOVED***
    _handleDirectory(directory, base) {
        try {
            const entries = this._scandir(directory, this._settings.fsScandirSettings);
            for (const entry of entries) {
                this._handleEntry(entry, base);
            ***REMOVED***
        ***REMOVED***
        catch (error) {
            this._handleError(error);
        ***REMOVED***
    ***REMOVED***
    _handleError(error) {
        if (!common.isFatalError(this._settings, error)) {
            return;
        ***REMOVED***
        throw error;
    ***REMOVED***
    _handleEntry(entry, base) {
        const fullpath = entry.path;
        if (base !== undefined) {
            entry.path = common.joinPathSegments(base, entry.name, this._settings.pathSegmentSeparator);
        ***REMOVED***
        if (common.isAppliedFilter(this._settings.entryFilter, entry)) {
            this._pushToStorage(entry);
        ***REMOVED***
        if (entry.dirent.isDirectory() && common.isAppliedFilter(this._settings.deepFilter, entry)) {
            this._pushToQueue(fullpath, base === undefined ? undefined : entry.path);
        ***REMOVED***
    ***REMOVED***
    _pushToStorage(entry) {
        this._storage.push(entry);
    ***REMOVED***
***REMOVED***
exports.default = SyncReader;

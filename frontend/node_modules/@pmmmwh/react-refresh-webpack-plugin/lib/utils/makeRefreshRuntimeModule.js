/**
 * Makes a runtime module to intercept module execution for React Refresh.
 * This module creates an isolated __webpak_require__ function for each module
 * and injects a $Refresh$ object into it for use by react-refresh.
 * @param {import('webpack')***REMOVED*** webpack The Webpack exports.
 * @returns {ReactRefreshRuntimeModule***REMOVED*** The runtime module class.
 */
function makeRefreshRuntimeModule(webpack) {
  return class ReactRefreshRuntimeModule extends webpack.RuntimeModule {
    constructor() {
      // Second argument is the `stage` for this runtime module -
      // we'll use the same stage as Webpack's HMR runtime module for safety.
      super('react refresh', webpack.RuntimeModule.STAGE_BASIC);
    ***REMOVED***

    /**
     * @returns {string***REMOVED*** runtime code
     */
    generate() {
      const { runtimeTemplate ***REMOVED*** = this.compilation;
      const declareVar = runtimeTemplate.supportsConst() ? 'const' : 'var';
      return webpack.Template.asString([
        `${declareVar***REMOVED*** setup = ${runtimeTemplate.basicFunction('moduleId', [
          `${declareVar***REMOVED*** refresh = {`,
          webpack.Template.indent([
            `moduleId: moduleId,`,
            `register: ${runtimeTemplate.basicFunction('type, id', [
              `${declareVar***REMOVED*** typeId = moduleId + " " + id;`,
              `refresh.runtime.register(type, typeId);`,
            ])***REMOVED***,`,
            `signature: ${runtimeTemplate.returningFunction(
              'refresh.runtime.createSignatureFunctionForTransform()'
            )***REMOVED***,`,
            `runtime: {`,
            webpack.Template.indent([
              `createSignatureFunctionForTransform: ${runtimeTemplate.returningFunction(
                runtimeTemplate.returningFunction('type', 'type')
              )***REMOVED***,`,
              `register: ${runtimeTemplate.emptyFunction()***REMOVED***`,
            ]),
            `***REMOVED***,`,
          ]),
          `***REMOVED***;`,
          `return refresh;`,
        ])***REMOVED***`,
        '',
        `${webpack.RuntimeGlobals.interceptModuleExecution***REMOVED***.push(${runtimeTemplate.basicFunction(
          'options',
          [
            `${declareVar***REMOVED*** originalFactory = options.factory;`,
            `options.factory = ${runtimeTemplate.basicFunction(
              ['moduleObject', 'moduleExports', 'webpackRequire'],
              [
                // Our require function delegates to the original require function
                `${declareVar***REMOVED*** hotRequire = ${runtimeTemplate.returningFunction(
                  'webpackRequire(request)',
                  'request'
                )***REMOVED***;`,
                // The propery descriptor factory below ensures that all properties but $Refresh$ are proxied through to the original require function
                `${declareVar***REMOVED*** createPropertyDescriptor = ${runtimeTemplate.basicFunction('name', [
                  `return {`,
                  webpack.Template.indent([
                    `configurable: true,`,
                    `enumerable: true,`,
                    `get: ${runtimeTemplate.returningFunction('webpackRequire[name]')***REMOVED***,`,
                    `set: ${runtimeTemplate.basicFunction('value', [
                      'webpackRequire[name] = value;',
                    ])***REMOVED***,`,
                  ]),
                  `***REMOVED***;`,
                ])***REMOVED***;`,
                `for (${declareVar***REMOVED*** name in webpackRequire) {`,
                webpack.Template.indent([
                  `if (Object.prototype.hasOwnProperty.call(webpackRequire, name) && name !== "$Refresh$") {`,
                  webpack.Template.indent([
                    `Object.defineProperty(hotRequire, name, createPropertyDescriptor(name));`,
                  ]),
                  `***REMOVED***`,
                ]),
                `***REMOVED***`,
                `hotRequire.$Refresh$ = setup(options.id);`,
                `originalFactory.call(this, moduleObject, moduleExports, hotRequire);`,
              ]
            )***REMOVED***;`,
          ]
        )***REMOVED***);`,
      ]);
    ***REMOVED***
  ***REMOVED***;
***REMOVED***

module.exports = makeRefreshRuntimeModule;

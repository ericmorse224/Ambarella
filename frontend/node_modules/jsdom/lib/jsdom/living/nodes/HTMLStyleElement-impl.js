"use strict";
const HTMLElementImpl = require("./HTMLElement-impl").implementation;
const { removeStylesheet, createStylesheet ***REMOVED*** = require("../helpers/stylesheets");
const { documentBaseURL ***REMOVED*** = require("../helpers/document-base-url");
const { childTextContent ***REMOVED*** = require("../helpers/text");
const { asciiCaseInsensitiveMatch ***REMOVED*** = require("../helpers/strings");

class HTMLStyleElementImpl extends HTMLElementImpl {
  constructor(globalObject, args, privateData) {
    super(globalObject, args, privateData);

    this.sheet = null;
    this._isOnStackOfOpenElements = false;
  ***REMOVED***

  _attach() {
    super._attach();
    if (!this._isOnStackOfOpenElements) {
      this._updateAStyleBlock();
    ***REMOVED***
  ***REMOVED***

  _detach() {
    super._detach();
    if (!this._isOnStackOfOpenElements) {
      this._updateAStyleBlock();
    ***REMOVED***
  ***REMOVED***

  _childTextContentChangeSteps() {
    super._childTextContentChangeSteps();

    // This guard is not required by the spec, but should be unobservable (since you can't run script during the middle
    // of parsing a <style> element) and saves a bunch of unnecessary work.
    if (!this._isOnStackOfOpenElements) {
      this._updateAStyleBlock();
    ***REMOVED***
  ***REMOVED***

  _poppedOffStackOfOpenElements() {
    this._isOnStackOfOpenElements = false;
    this._updateAStyleBlock();
  ***REMOVED***

  _pushedOnStackOfOpenElements() {
    this._isOnStackOfOpenElements = true;
  ***REMOVED***

  _updateAStyleBlock() {
    if (this.sheet) {
      removeStylesheet(this.sheet, this);
    ***REMOVED***

    // Browsing-context connected, per https://github.com/whatwg/html/issues/4547
    if (!this.isConnected || !this._ownerDocument._defaultView) {
      return;
    ***REMOVED***

    const type = this.getAttributeNS(null, "type");
    if (type !== null && type !== "" && !asciiCaseInsensitiveMatch(type, "text/css")) {
      return;
    ***REMOVED***

    // Not implemented: CSP

    const content = childTextContent(this);
    // Not implemented: a bunch of other state, e.g. title/media attributes
    createStylesheet(content, this, documentBaseURL(this._ownerDocument));
  ***REMOVED***
***REMOVED***

module.exports = {
  implementation: HTMLStyleElementImpl
***REMOVED***;

var Token = require('../../tokenizer/token');

var serializeBody = require('../../writer/one-time').body;
var serializeRules = require('../../writer/one-time').rules;

function removeDuplicates(tokens) {
  var matched = {***REMOVED***;
  var moreThanOnce = [];
  var id, token;
  var body, bodies;

  for (var i = 0, l = tokens.length; i < l; i++) {
    token = tokens[i];
    if (token[0] != Token.RULE) { continue; ***REMOVED***

    id = serializeRules(token[1]);

    if (matched[id] && matched[id].length == 1) { moreThanOnce.push(id); ***REMOVED*** else { matched[id] = matched[id] || []; ***REMOVED***

    matched[id].push(i);
  ***REMOVED***

  for (i = 0, l = moreThanOnce.length; i < l; i++) {
    id = moreThanOnce[i];
    bodies = [];

    for (var j = matched[id].length - 1; j >= 0; j--) {
      token = tokens[matched[id][j]];
      body = serializeBody(token[2]);

      if (bodies.indexOf(body) > -1) { token[2] = []; ***REMOVED*** else { bodies.push(body); ***REMOVED***
    ***REMOVED***
  ***REMOVED***
***REMOVED***

module.exports = removeDuplicates;

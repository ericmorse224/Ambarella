'use strict'

const test = require('tape')
const URI = require('../')

test('URI Serialize', (t) => {
  let components = {
    scheme: undefined,
    userinfo: undefined,
    host: undefined,
    port: undefined,
    path: undefined,
    query: undefined,
    fragment: undefined
  ***REMOVED***
  t.equal(URI.serialize(components), '', 'Undefined Components')

  components = {
    scheme: '',
    userinfo: '',
    host: '',
    port: 0,
    path: '',
    query: '',
    fragment: ''
  ***REMOVED***
  t.equal(URI.serialize(components), '//@:0?#', 'Empty Components')

  components = {
    scheme: 'uri',
    userinfo: 'foo:bar',
    host: 'example.com',
    port: 1,
    path: 'path',
    query: 'query',
    fragment: 'fragment'
  ***REMOVED***
  t.equal(URI.serialize(components), 'uri://foo:bar@example.com:1/path?query#fragment', 'All Components')

  components = {
    scheme: 'uri',
    host: 'example.com',
    port: '9000'
  ***REMOVED***
  t.equal(URI.serialize(components), 'uri://example.com:9000', 'String port')

  t.equal(URI.serialize({ path: '//path' ***REMOVED***), '/%2Fpath', 'Double slash path')
  t.equal(URI.serialize({ path: 'foo:bar' ***REMOVED***), 'foo%3Abar', 'Colon path')
  t.equal(URI.serialize({ path: '?query' ***REMOVED***), '%3Fquery', 'Query path')

  t.equal(URI.serialize({ host: '10.10.10.10' ***REMOVED***), '//10.10.10.10', 'IPv4address')

  // mixed IPv4address & reg-name, example from terion-name (https://github.com/garycourt/uri-js/issues/4)
  t.equal(URI.serialize({ host: '10.10.10.10.example.com' ***REMOVED***), '//10.10.10.10.example.com', 'Mixed IPv4address & reg-name')

  // IPv6address
  t.equal(URI.serialize({ host: '2001:db8::7' ***REMOVED***), '//[2001:db8::7]', 'IPv6 Host')
  t.equal(URI.serialize({ host: '::ffff:129.144.52.38' ***REMOVED***), '//[::ffff:129.144.52.38]', 'IPv6 Mixed Host')
  t.equal(URI.serialize({ host: '2606:2800:220:1:248:1893:25c8:1946' ***REMOVED***), '//[2606:2800:220:1:248:1893:25c8:1946]', 'IPv6 Full Host')

  // IPv6address with zone identifier, RFC 6874
  t.equal(URI.serialize({ host: 'fe80::a%en1' ***REMOVED***), '//[fe80::a%25en1]', 'IPv6 Zone Unescaped Host')
  t.equal(URI.serialize({ host: 'fe80::a%25en1' ***REMOVED***), '//[fe80::a%25en1]', 'IPv6 Zone Escaped Host')

  t.end()
***REMOVED***)

test('WS serialize', (t) => {
  t.equal(URI.serialize({ scheme: 'ws' ***REMOVED***), 'ws:')
  t.equal(URI.serialize({ scheme: 'ws', host: 'example.com' ***REMOVED***), 'ws://example.com')
  t.equal(URI.serialize({ scheme: 'ws', resourceName: '/' ***REMOVED***), 'ws:')
  t.equal(URI.serialize({ scheme: 'ws', resourceName: '/foo' ***REMOVED***), 'ws:/foo')
  t.equal(URI.serialize({ scheme: 'ws', resourceName: '/foo?bar' ***REMOVED***), 'ws:/foo?bar')
  t.equal(URI.serialize({ scheme: 'ws', secure: false ***REMOVED***), 'ws:')
  t.equal(URI.serialize({ scheme: 'ws', secure: true ***REMOVED***), 'wss:')
  t.equal(URI.serialize({ scheme: 'ws', host: 'example.com', resourceName: '/foo' ***REMOVED***), 'ws://example.com/foo')
  t.equal(URI.serialize({ scheme: 'ws', host: 'example.com', resourceName: '/foo?bar' ***REMOVED***), 'ws://example.com/foo?bar')
  t.equal(URI.serialize({ scheme: 'ws', host: 'example.com', secure: false ***REMOVED***), 'ws://example.com')
  t.equal(URI.serialize({ scheme: 'ws', host: 'example.com', secure: true ***REMOVED***), 'wss://example.com')
  t.equal(URI.serialize({ scheme: 'ws', host: 'example.com', resourceName: '/foo?bar', secure: false ***REMOVED***), 'ws://example.com/foo?bar')
  t.equal(URI.serialize({ scheme: 'ws', host: 'example.com', resourceName: '/foo?bar', secure: true ***REMOVED***), 'wss://example.com/foo?bar')
  t.end()
***REMOVED***)

test('WSS serialize', (t) => {
  t.equal(URI.serialize({ scheme: 'wss' ***REMOVED***), 'wss:')
  t.equal(URI.serialize({ scheme: 'wss', host: 'example.com' ***REMOVED***), 'wss://example.com')
  t.equal(URI.serialize({ scheme: 'wss', resourceName: '/' ***REMOVED***), 'wss:')
  t.equal(URI.serialize({ scheme: 'wss', resourceName: '/foo' ***REMOVED***), 'wss:/foo')
  t.equal(URI.serialize({ scheme: 'wss', resourceName: '/foo?bar' ***REMOVED***), 'wss:/foo?bar')
  t.equal(URI.serialize({ scheme: 'wss', secure: false ***REMOVED***), 'ws:')
  t.equal(URI.serialize({ scheme: 'wss', secure: true ***REMOVED***), 'wss:')
  t.equal(URI.serialize({ scheme: 'wss', host: 'example.com', resourceName: '/foo' ***REMOVED***), 'wss://example.com/foo')
  t.equal(URI.serialize({ scheme: 'wss', host: 'example.com', resourceName: '/foo?bar' ***REMOVED***), 'wss://example.com/foo?bar')
  t.equal(URI.serialize({ scheme: 'wss', host: 'example.com', secure: false ***REMOVED***), 'ws://example.com')
  t.equal(URI.serialize({ scheme: 'wss', host: 'example.com', secure: true ***REMOVED***), 'wss://example.com')
  t.equal(URI.serialize({ scheme: 'wss', host: 'example.com', resourceName: '/foo?bar', secure: false ***REMOVED***), 'ws://example.com/foo?bar')
  t.equal(URI.serialize({ scheme: 'wss', host: 'example.com', resourceName: '/foo?bar', secure: true ***REMOVED***), 'wss://example.com/foo?bar')

  t.end()
***REMOVED***)

test('URN serialize', (t) => {
// example from RFC 2141
  const components = {
    scheme: 'urn',
    nid: 'foo',
    nss: 'a123,456'
  ***REMOVED***
  t.equal(URI.serialize(components), 'urn:foo:a123,456')
  // example from RFC 4122
  let uuidcomponents = {
    scheme: 'urn',
    nid: 'uuid',
    uuid: 'f81d4fae-7dec-11d0-a765-00a0c91e6bf6'
  ***REMOVED***
  t.equal(URI.serialize(uuidcomponents), 'urn:uuid:f81d4fae-7dec-11d0-a765-00a0c91e6bf6')

  uuidcomponents = {
    scheme: 'urn',
    nid: 'uuid',
    uuid: 'notauuid-7dec-11d0-a765-00a0c91e6bf6'
  ***REMOVED***
  t.equal(URI.serialize(uuidcomponents), 'urn:uuid:notauuid-7dec-11d0-a765-00a0c91e6bf6')
  t.end()
***REMOVED***)
test('URN NID Override', (t) => {
  let components = URI.parse('urn:foo:f81d4fae-7dec-11d0-a765-00a0c91e6bf6', { nid: 'uuid' ***REMOVED***)
  t.equal(components.error, undefined, 'errors')
  t.equal(components.scheme, 'urn', 'scheme')
  t.equal(components.path, undefined, 'path')
  t.equal(components.nid, 'foo', 'nid')
  t.equal(components.nss, undefined, 'nss')
  t.equal(components.uuid, 'f81d4fae-7dec-11d0-a765-00a0c91e6bf6', 'uuid')

  components = {
    scheme: 'urn',
    nid: 'foo',
    uuid: 'f81d4fae-7dec-11d0-a765-00a0c91e6bf6'
  ***REMOVED***
  t.equal(URI.serialize(components, { nid: 'uuid' ***REMOVED***), 'urn:foo:f81d4fae-7dec-11d0-a765-00a0c91e6bf6')
  t.end()
***REMOVED***)

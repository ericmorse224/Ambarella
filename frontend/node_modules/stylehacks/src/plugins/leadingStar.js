'use strict';
const BasePlugin = require('../plugin');
const { IE_5_5, IE_6, IE_7 ***REMOVED*** = require('../dictionary/browsers');
const { PROPERTY ***REMOVED*** = require('../dictionary/identifiers');
const { ATRULE, DECL ***REMOVED*** = require('../dictionary/postcss');

const hacks = '!_$_&_*_)_=_%_+_,_._/_`_]_#_~_?_:_|'.split('_');

module.exports = class LeadingStar extends BasePlugin {
  /** @param {import('postcss').Result=***REMOVED*** result */
  constructor(result) {
    super([IE_5_5, IE_6, IE_7], [ATRULE, DECL], result);
  ***REMOVED***

  /**
   * @param {import('postcss').Declaration | import('postcss').AtRule***REMOVED*** node
   * @return {void***REMOVED***
   */
  detect(node) {
    if (node.type === DECL) {
      // some values are not picked up by before, so ensure they are
      // at the beginning of the value
      hacks.forEach((hack) => {
        if (!node.prop.indexOf(hack)) {
          this.push(node, {
            identifier: PROPERTY,
            hack: node.prop,
          ***REMOVED***);
        ***REMOVED***
      ***REMOVED***);
      const { before ***REMOVED*** = node.raws;
      if (!before) {
        return;
      ***REMOVED***
      hacks.forEach((hack) => {
        if (before.includes(hack)) {
          this.push(node, {
            identifier: PROPERTY,
            hack: `${before.trim()***REMOVED***${node.prop***REMOVED***`,
          ***REMOVED***);
        ***REMOVED***
      ***REMOVED***);
    ***REMOVED*** else {
      // test for the @property: value; hack
      const { name ***REMOVED*** = node;
      const len = name.length - 1;
      if (name.lastIndexOf(':') === len) {
        this.push(node, {
          identifier: PROPERTY,
          hack: `@${name.substr(0, len)***REMOVED***`,
        ***REMOVED***);
      ***REMOVED***
    ***REMOVED***
  ***REMOVED***
***REMOVED***;

"use strict";

const {isIP***REMOVED*** = require("net");
const execa = require("execa");
const dests = new Set(["default", "0.0.0.0", "0.0.0.0/0", "::", "::/0"]);

const args = {
  v4: ["-rn", "-f", "inet"],
  v6: ["-rn", "-f", "inet6"],
***REMOVED***;

const parse = stdout => {
  let result;

  (stdout || "").trim().split("\n").some(line => {
    const [target, gateway, _, iface] = line.split(/ +/) || [];
    if (dests.has(target) && gateway && isIP(gateway)) {
      result = {gateway, interface: (iface ? iface : null)***REMOVED***;
      return true;
    ***REMOVED***
  ***REMOVED***);

  if (!result) {
    throw new Error("Unable to determine default gateway");
  ***REMOVED***

  return result;
***REMOVED***;

const promise = async family => {
  const {stdout***REMOVED*** = await execa("netstat", args[family]);
  return parse(stdout);
***REMOVED***;

const sync = family => {
  const {stdout***REMOVED*** = execa.sync("netstat", args[family]);
  return parse(stdout);
***REMOVED***;

module.exports.v4 = () => promise("v4");
module.exports.v6 = () => promise("v6");

module.exports.v4.sync = () => sync("v4");
module.exports.v6.sync = () => sync("v6");

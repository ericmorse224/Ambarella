'use strict';
const {PassThrough: PassThroughStream***REMOVED*** = require('stream');

module.exports = options => {
	options = {...options***REMOVED***;

	const {array***REMOVED*** = options;
	let {encoding***REMOVED*** = options;
	const isBuffer = encoding === 'buffer';
	let objectMode = false;

	if (array) {
		objectMode = !(encoding || isBuffer);
	***REMOVED*** else {
		encoding = encoding || 'utf8';
	***REMOVED***

	if (isBuffer) {
		encoding = null;
	***REMOVED***

	const stream = new PassThroughStream({objectMode***REMOVED***);

	if (encoding) {
		stream.setEncoding(encoding);
	***REMOVED***

	let length = 0;
	const chunks = [];

	stream.on('data', chunk => {
		chunks.push(chunk);

		if (objectMode) {
			length = chunks.length;
		***REMOVED*** else {
			length += chunk.length;
		***REMOVED***
	***REMOVED***);

	stream.getBufferedValue = () => {
		if (array) {
			return chunks;
		***REMOVED***

		return isBuffer ? Buffer.concat(chunks, length) : chunks.join('');
	***REMOVED***;

	stream.getBufferedLength = () => length;

	return stream;
***REMOVED***;

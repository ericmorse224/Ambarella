'use strict';

var test = require('tape');
var inspect = require('object-inspect');
var forEach = require('for-each');

var SLOT = require('../');

test('assert', function (t) {
	forEach([null, undefined, true, false, 'foo', '', 42, 0], function (primitive) {
		t['throws'](
			// @ts-expect-error
			function () { SLOT.assert(primitive, ''); ***REMOVED***,
			TypeError,
			inspect(primitive) + ' is not an Object'
		);
	***REMOVED***);

	forEach([null, undefined, true, false, 42, 0, {***REMOVED***, [], function () {***REMOVED***, /a/g], function (nonString) {
		t['throws'](
			// @ts-expect-error
			function () { SLOT.assert({***REMOVED***, nonString); ***REMOVED***,
			TypeError,
			inspect(nonString) + ' is not a String'
		);
	***REMOVED***);

	t['throws'](
		function () { SLOT.assert({***REMOVED***, '[[whatever]]'); ***REMOVED***,
		TypeError,
		'nonexistent slot throws'
	);

	var o = {***REMOVED***;
	SLOT.set(o, 'x');
	t.doesNotThrow(function () { SLOT.assert(o, 'x'); ***REMOVED***, 'existent slot noops');
	t['throws'](function () { SLOT.assert(o, 'y'); ***REMOVED***, 'thing with a slot throws on a nonexistent slot');

	t.end();
***REMOVED***);

test('has', function (t) {
	forEach([null, undefined, true, false, 'foo', '', 42, 0], function (primitive) {
		t['throws'](
			// @ts-expect-error
			function () { SLOT.has(primitive, ''); ***REMOVED***,
			TypeError,
			inspect(primitive) + ' is not an Object'
		);
	***REMOVED***);

	forEach([null, undefined, true, false, 42, 0, {***REMOVED***, [], function () {***REMOVED***, /a/g], function (nonString) {
		t['throws'](
			// @ts-expect-error
			function () { SLOT.has({***REMOVED***, nonString); ***REMOVED***,
			TypeError,
			inspect(nonString) + ' is not a String'
		);
	***REMOVED***);

	var o = {***REMOVED***;

	t.equal(SLOT.has(o, '[[nonexistent]]'), false, 'nonexistent slot yields false');

	SLOT.set(o, 'foo');
	t.equal(SLOT.has(o, 'foo'), true, 'existent slot yields true');

	t.end();
***REMOVED***);

test('get', function (t) {
	forEach([null, undefined, true, false, 'foo', '', 42, 0], function (primitive) {
		t['throws'](
			// @ts-expect-error
			function () { SLOT.get(primitive, ''); ***REMOVED***,
			TypeError,
			inspect(primitive) + ' is not an Object'
		);
	***REMOVED***);

	forEach([null, undefined, true, false, 42, 0, {***REMOVED***, [], function () {***REMOVED***, /a/g], function (nonString) {
		t['throws'](
			// @ts-expect-error
			function () { SLOT.get({***REMOVED***, nonString); ***REMOVED***,
			TypeError,
			inspect(nonString) + ' is not a String'
		);
	***REMOVED***);

	var o = {***REMOVED***;
	t.equal(SLOT.get(o, 'nonexistent'), undefined, 'nonexistent slot is undefined');

	var v = {***REMOVED***;
	SLOT.set(o, 'f', v);
	t.equal(SLOT.get(o, 'f'), v, '"get" retrieves value set by "set"');

	t.end();
***REMOVED***);

test('set', function (t) {
	forEach([null, undefined, true, false, 'foo', '', 42, 0], function (primitive) {
		t['throws'](
			// @ts-expect-error
			function () { SLOT.set(primitive, ''); ***REMOVED***,
			TypeError,
			inspect(primitive) + ' is not an Object'
		);
	***REMOVED***);

	forEach([null, undefined, true, false, 42, 0, {***REMOVED***, [], function () {***REMOVED***, /a/g], function (nonString) {
		t['throws'](
			// @ts-expect-error
			function () { SLOT.set({***REMOVED***, nonString); ***REMOVED***,
			TypeError,
			inspect(nonString) + ' is not a String'
		);
	***REMOVED***);

	var o = function () {***REMOVED***;
	t.equal(SLOT.get(o, 'f'), undefined, 'slot not set');

	SLOT.set(o, 'f', 42);
	t.equal(SLOT.get(o, 'f'), 42, 'slot was set');

	SLOT.set(o, 'f', Infinity);
	t.equal(SLOT.get(o, 'f'), Infinity, 'slot was set again');

	t.end();
***REMOVED***);

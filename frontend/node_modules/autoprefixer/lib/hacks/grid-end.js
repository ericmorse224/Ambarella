let Declaration = require('../declaration')
let { isPureNumber ***REMOVED*** = require('../utils')

class GridEnd extends Declaration {
  /**
   * Change repeating syntax for IE
   */
  insert(decl, prefix, prefixes, result) {
    if (prefix !== '-ms-') return super.insert(decl, prefix, prefixes)

    let clonedDecl = this.clone(decl)

    let startProp = decl.prop.replace(/end$/, 'start')
    let spanProp = prefix + decl.prop.replace(/end$/, 'span')

    if (decl.parent.some(i => i.prop === spanProp)) {
      return undefined
    ***REMOVED***

    clonedDecl.prop = spanProp

    if (decl.value.includes('span')) {
      clonedDecl.value = decl.value.replace(/span\s/i, '')
    ***REMOVED*** else {
      let startDecl
      decl.parent.walkDecls(startProp, d => {
        startDecl = d
      ***REMOVED***)
      if (startDecl) {
        if (isPureNumber(startDecl.value)) {
          let value = Number(decl.value) - Number(startDecl.value) + ''
          clonedDecl.value = value
        ***REMOVED*** else {
          return undefined
        ***REMOVED***
      ***REMOVED*** else {
        decl.warn(
          result,
          `Can not prefix ${decl.prop***REMOVED*** (${startProp***REMOVED*** is not found)`
        )
      ***REMOVED***
    ***REMOVED***

    decl.cloneBefore(clonedDecl)

    return undefined
  ***REMOVED***
***REMOVED***

GridEnd.names = ['grid-row-end', 'grid-column-end']

module.exports = GridEnd
